var Events={APP_READY:"app_ready_cb",CONTRIBUTE:{READY:"contribute_ready_cb",RECEIVE_CONTRIBUTE:"recevive_contribute_cb",RESET_CONTRIBUTE:"reset_contribute_cb",PREV_RESULT:"prev_result_cb",NEXT_RESULT:"next_result_cb",PREV_PAGE:"prev_page_cb",NEXT_PAGE:"next_page_cb"},ENTPUB:{PRESENT_READY:"present_ready_cb",LIST_PRESENT_READY:"list_present_cb",RECEIVE_PRESENT:"receive_present_cb",BUY_PRESENT_RESULT:"buy_present_result_cb",BUY_PRESENT_CONFIRM:"buy_present_confirm_result_cb",BUY_PRESENT_CONFIRM_RESULT:"buy_present_confirm_result_cb",BUY_PRESENT_COMBO_EFFECT:"buy_present_combo_effect_cb",BUY_PRESENT_UNION_GIFT_CB:"buy_present_union_gift_cb",BUY_PRESENT_COMBO_EFFECT_ALL_CB:"buy_present_combo_effect_all_cb",CANCEL_PRESENT_UNION_GIFT_CB:"cancel_present_union_gift_cb",BUY_PRESENT_FREE_REQ:"call_buy_present",BUY_PRESENT_FREE_RESP:"free_present_send_result_cb",FREE_PACKAGE_LIST_REQ:"call_free_package_list",FREE_PACKAGE_LIST_RESP:"free_present_list_cb"},INFORMME:{READY:"inform_ready_cb",NUMBER_CHANGE:"inform_number_change_cb",SUB_RESULT:"sub_inform_result_cb",SUB_CLICK:"sub_inform_click"},PERSONAL:{FIRST_MIC_CHANGE:"first_mic_change_cb",FLOWER_CHANGE:"flower_change_cb",TICKET_CHANGE:"ticket_change_cb"},CHAT:{CHAT_READY:"chat_ready_cb",CHAT_MSG_BROADCAST_CB:"chat_msg_broadcast_cb",CHAT_SEND_MSG_CB:"chat_send_msg_cb",CHAT_FOR_BID_REQ_CB:"Chat_for_bid_req_cb"},CAR:{CAR_RSP_CHANNEL_PARK:"car_rsp_channel_park",CAR_BC_USER_CAR_ENTER:"car_bc_user_car_enter",CAR_BC_USER_CAR_OUT:"car_bc_user_car_out"},NOBLE:{RECEVIVE_NOBLE_RANK_CB:"as_send_noble_list_cb",AS_CALL_SHOW_NOBLE_LIST_CB:"as_call_show_noble_list_cb",NOTICE_NOBLE_UPDATE:"responseMynobleInfo"},ACT_TURNTABLE:{SHOW_TREASURE_GRAB_RANK_BOX:"callJsTreasureBoxGrabRank",SHOW_EXCHANGE_RED_DIAMOND_BOX:"callJsExchangeRedDiamond",SHOW_TURNTABLE_ICON:"callJsTurnableIconUrl",RECEIVED_TURNTABLE_GIFT:"callJsUpdateGift",SHOW_LACK_RED_BOX:"callJsNotEnoughRedDiamond",IS_LOGIN_FOR_RANK_BOX:"grabTreasureNoLogin",RECEIVED_MY_RANK_DATA:"callJsMyGrab"},HEADER:{REFRESH_USER_INFO_FLAG:"userLoginInfoUIRefresh"}};var EntFns={CONTRIBUTE:{REQUEST_LIST:"call_contribute_request_list"},ENTPUB:{BUY_PRESENT:"call_buy_present",BUY_PRESENT_CONFIRM:"call_buy_present_confirm"},INFORMME:{SUB_UNSUB:"call_sub_unsub"},CHAT:{CHAT_SEND_MSG_CALL:"chat_send_msg_call",CHAT_FOR_BID_REQ:"Chat_for_bid_req"},NOBLE:{CHAT_SEND_NOBLE_MSG_CALL:"chat_send_noble_msg_call"},ACT_ACT_TURNTABLE:{SHOW_TURNTABLE:"callAsPopupTurnTableWindow",UPDATE_TURNTABLE_RED:"callAsUpdateRedDiamond",HIDE_TURNTABLE_FORWARD_ICON:"callAsHideForwardIcon"}};var EntAppReady={flashEntReadyCallback:null,ready:false,isReady:function(){return EntAppReady.ready},init:function(){window.asIsReady=function(){console.log("flash检测到js加载完毕后，通知页js , asIsReady");EntAppReady.ready=true;EntAppReady.invokeCallbackFuns()};window.asCheckJS=function(){console.log("flash检测js是否加载完毕");EntAppReady.addFlashEntReadyCallback(function(){console.log("注册回调函数样例")});EntAppReady.addFlashEntReadyCallback(EntAppReady.getNobleList);EntAppReady.addFlashEntReadyCallback(TaskBar.requestBar);EntAppReady.addFlashEntReadyCallback(Turntable.addListeners);EntAppReady.addFlashEntReadyCallback(Turntable.hideTurntableForwardIcon);return"ok"}},addFlashEntReadyCallback:function(a){if(!$.isFunction(a)){console.log("addFlashEntReadyCallback,param is wrong! "+a+" is not a function");return}if(!EntAppReady.flashEntReadyCallback){EntAppReady.flashEntReadyCallback=[]}EntAppReady.flashEntReadyCallback.push(a)},invokeCallbackFuns:function(){if(!EntAppReady.flashEntReadyCallback){console.log("no flashEntReadyCallback!");return}for(var a in EntAppReady.flashEntReadyCallback){if(EntAppReady.flashEntReadyCallback[a]){EntAppReady.flashEntReadyCallback[a]()}}}};window.asCheckJS=function(){console.log("flash检测js是否加载完毕");return"no"};var EntAppHandler={appid:"60040",entKey:{toAs:"callEntApp",toJs:"entAppCallback"},cbMethods:{},init:function(){try{EntAppHandler.registerCallBack(EntAppHandler.entKey.toJs,"EntAppHandler.entCallback")}catch(a){console.log(a)}this.addEventListener("live_app_ready_cb",EntAppHandler.entAppReady);this.addEventListener("ENT_JSON_CALL_BACK",EntAppHandler.entAppCallback);this.addEventListener("channel_kick",EntAppHandler.kickoutChannel);this.addEventListener("logout",EntAppHandler.logoutChannel);this.addEventListener("getSingerMicCard",EntAppHandler.getSingerMicCard);Gift.addEntListeners();this.addEventListener("receive_gift_history",giftHistory.receiveGiftHistory);this.addEventListener(Events.CONTRIBUTE.READY,dedicate.ready);this.addEventListener(Events.CONTRIBUTE.RECEIVE_CONTRIBUTE,dedicate.receiveContribute);this.addEventListener(Events.CONTRIBUTE.PREV_RESULT,dedicate.prevResult);this.addEventListener(Events.CONTRIBUTE.NEXT_RESULT,dedicate.nextResult);this.addEventListener(Events.NOBLE.RECEVIVE_NOBLE_RANK_CB,roomNoble.respNoble);this.addEventListener(Events.NOBLE.AS_CALL_SHOW_NOBLE_LIST_CB,roomNoble.showNobleList);this.addEventListener(Events.NOBLE.NOTICE_NOBLE_UPDATE,roomNoble.myNobleInfoResponse);this.addEventListener("nobleLevelUpgrade",roomNoble.nobleLevelUpgrade);this.addEventListener("openNobleBC",roomNoble.openNobleBC);this.addEventListener("truelove_celan_v4_info_rsp",cherish.receiveCherishBasicInfo);this.addEventListener("truelove_celan_v4_info_update_bc",cherish.receiveCherishBasicInfo);this.addEventListener("truelove_toujie_v4_info_rsp",cherish.receiveMyFansTitleInfo);this.addEventListener("truelove_toujie_v4_rank_rsp",cherish.receiveFansRankInfo);this.addEventListener("truelove_open_bc",cherish.receiveCherishBasicInfo);this.addEventListener("truelove_get_current_group_score_rsp",cherish.receiveGroupInfo);this.addEventListener("callJsTurnTableEntryNotice",BroadcasttHistory.receiveBroadcastHistory);this.addEventListener(Events.HEADER.REFRESH_USER_INFO_FLAG,function(){header.headerUserInfoRefresh=true})},registerCallBack:function(b,a){try{getFlashObj().registerCallBack(b,a)}catch(c){console.log(c)}},entCallback:function(c){if(c.param){var a=c.param.uri;if(window.location.hash=="#debug"){console.log("EntAppHandler.entCallback URI:"+a)}var b=c.param.data;if(this.cbMethods[a]){this.cbMethods[a](b)}}},call:function(a,b){return EntAppHandler.sendToFlash(this.entKey.toAs,{uri:a,data:b})},sendToFlash:function(b,d,a){if(EntAppReady.isReady()){try{if(a){return getFlashObj().callAs(b,d,a)}return getFlashObj().callAs(b,d)}catch(c){console.log(c)}return false}return false},baseSend:function(a,b){b=$.parseJSON(b);b.appid=this.appid;b=JSON.stringify(b);console.log("SAL UP:"+b);return EntAppHandler.sendToFlash(this.entKey.toAs,{uri:a,data:b})},send:function(a){this.baseSend("sendEntJsonV2",a)},sendJson:function(a){this.baseSendJson("sendEntJsonV2",a)},baseSendJson:function(a,b){b.appid=this.appid;b=JSON.stringify(b);console.log("SAL UP:"+b);return EntAppHandler.sendToFlash(this.entKey.toAs,{uri:a,data:b})},addEventListener:function(b,a){if(a){this.cbMethods[b]=a}},entAppReady:function(){},entAppCallback:function(a){},kickoutChannel:function(){RoomFlashContainer.showErrorTips("您打开了另一直播间，当前直播暂停")},logoutChannel:function(){$.messagebox({type:"noCloseBtn",msg:"您打开了另一直播间，当前直播暂停",buttons:[{text:"继续播放",iconCls:"ico-btn-order-ok"}],fn:function(a,b){if(0==a.index){window.location.reload()}}})}};function getFlashObj(a){return liveplayer.web2flash.ctrl};var liveplayer={userlist:true,share:true,more:true,endPage:true,web2flash:null,pageInfo:null,player:null,firstMic:null,iResearch_Monitor:0,monitorType:[],showMaskList:{},onVideoPlayCallbacks:[],onVideoPauseCallbacks:[],onVideoStopCallbacks:[],onMicListChangeCallbacks:[],onFollowUserCallbacks:[],onCancelFollowUserCallbacks:[],onZanCallbacks:[],currentMaskUser:"",onload:function(c,b,a,d){liveplayer.pageInfo=c;liveplayer.web2flash=b;liveplayer.player=d;liveplayer.init()},init:function(){liveplayer.web2flash.onStatusChange(liveplayer.onStatusChange);liveplayer.web2flash.onEnterLiveRoom(liveplayer.onEnterLiveroom);liveplayer.web2flash.onMicListChange(liveplayer.onMicListChange);liveplayer.web2flash.onFollowUser(liveplayer.onFollowUser);liveplayer.web2flash.onCancelFollowUser(liveplayer.onCancelFollowUser);liveplayer.web2flash.onZan(liveplayer.onZan);liveplayer.web2flash.onThirdMonitor(liveplayer.onThirdMonitor);EntAppHandler.init();EntAppReady.init();liveplayer.onPopMaskShow();liveplayer.addMicListChangeCallback(function(b){if(b.length==0){p_activity_anchor_down_channel_callback();liveplayer.firstMic=null}else{if(liveplayer.firstMic==null){liveplayer.firstMic=b[0]}else{if(liveplayer.firstMic==b[0]){}else{p_activity_anchor_down_channel_callback();liveplayer.firstMic=b[0]}}p_activity_anchor_up_channel_callback()}});var a=liveplayer.web2flash.getMicListSync();if(a&&a.length>0){liveplayer.firstMic=a[0]}},onThirdMonitor:function(d){if(d!=null){var c=d.monitorJsUrl;if(document.getElementById("third_monitor_id")){document.getElementById("third_monitor_id").src=c}else{var a=document.createElement("script");a.type="text/javascript";a.language="javascript";a.id="third_monitor_id";a.src=c;$("head")[0].appendChild(a)}liveplayer.monitorType=[];if(d.monitors){for(var b in d.monitors){if(d.monitors[b]!=null&&d.monitors[b].monitorType!=null){liveplayer.monitorType.push(d.monitors[b].monitorType)}}}}},onStatusChange:function(a){switch(a){case"play":liveplayer.onChange(liveplayer.onVideoPlayCallbacks);break;case"pause":liveplayer.onChange(liveplayer.onVideoPauseCallbacks);break;case"stop":liveplayer.onChange(liveplayer.onVideoStopCallbacks);break;default:break}},onChange:function(a,c){var d=a.length;if(d>0){for(var b=0;b<d;b++){a[b](c)}}},addVideoPlayCallback:function(a){liveplayer.onVideoPlayCallbacks.push(a)},addVideoPlayCallback:function(a){liveplayer.onVideoPauseCallbacks.push(a)},addVideoPlayCallback:function(a){liveplayer.onVideoStopCallbacks.push(a)},onEnterLiveroom:function(a){},onMicListChange:function(a){liveplayer.onChange(liveplayer.onMicListChangeCallbacks,a)},addMicListChangeCallback:function(a){liveplayer.onMicListChangeCallbacks.push(a)},onFollowUser:function(){liveplayer.onChange(liveplayer.onFollowUserCallbacks)},addFollowUserCallback:function(a){liveplayer.onFollowUserCallbacks.push(a)},onCancelFollowUser:function(){liveplayer.onChange(liveplayer.onCancelFollowUserCallbacks)},addCancelFollowUserCallback:function(a){liveplayer.onCancelFollowUserCallbacks.push(a)},onZan:function(){liveplayer.onChange(liveplayer.onZanCallbacks)},addOnZanCallbacks:function(a){liveplayer.onZanCallbacks.push(a)},setSponsorsIcon:function(a){liveplayer.web2flash.setSponsorsIcon(a)},resize:function(b,a){liveplayer.web2flash.resize(b,a)},enableDanmu:function(){liveplayer.web2flash.danmu.enable()},disableDanmu:function(){liveplayer.web2flash.danmu.disable()},followUser:function(a){liveplayer.web2flash.followUser(a)},cancelFollowUser:function(a){liveplayer.web2flash.cancelFollowUser(a)},getUserCount:function(a){liveplayer.web2flash.getUserCount(a)},getUserList:function(b,a){liveplayer.web2flash.getUserList(b,a)},sendMessage:function(a){liveplayer.web2flash.sendMessage(a)},zan:function(){liveplayer.web2flash.zan()},getConfig:function(a){liveplayer.web2flash.config.get(a)},setConfig:function(a,b){liveplayer.web2flash.config.set(a,b)},setZanCount:function(a){liveplayer.web2flash.setZanCount(a)},showMask:function(a){if(a){liveplayer.currentMaskUser=a}if(liveplayer.player){liveplayer.player.popMask.show()}},hideMask:function(){if(liveplayer.player){liveplayer.player.popMask.hide()}},onPopMaskShow:function(){liveplayer.player.popMask.onPopMaskShow(function(){liveplayer.clearMask()})},onPopMaskHide:function(){liveplayer.player.popMask.onPopMaskHide(function(){})},hasSponsor:function(){if(liveplayer.pageInfo){return(typeof(liveplayer.pageInfo.sponsors.url)=="undefined"||liveplayer.pageInfo.title==null||liveplayer.pageInfo.title=="")?false:true}else{return false}},clearMask:function(){$(".useMask").removeClass("current");if(weekStar.isWeekShow){weekStar.isWeekShow=false}},onFullscreen:function(b,a){w2f.onFullscreen(b,a)}};var RoomRegistGuide={showLowerRightCornerTime:30*1000,registBox:$("#regist-guide-box-id"),roomRightSide:$(".w-liveplayer .w-liveplayer-side"),init:function(){var a=RoomRegistGuide;RoomRegistGuide.suitSize();header.onresize(function(){RoomRegistGuide.suitSize()});$("#regist-guide-box-id").bind("click",function(c){c=c||window.event;var d=c.target||c.srcElement;console.log(d);if(d.nodeName=="A"){a.hideRegistGuideBox();c.stopPropagation();return}else{var b=LoginUtil.isLogin();if(!b){LoginUtil.showLoginOrRegister();a.hideRegistGuideBox()}}})},suitSize:function(){var c=navigator.userAgent.toLowerCase();var d=/msie 7.0/.test(c);var b=RoomRegistGuide.roomRightSide.width();var a=0-b+1;if(d){RoomRegistGuide.registBox.css({width:b,right:0})}else{RoomRegistGuide.registBox.css({width:b,right:a})}},hideRegistGuideBox:function(){var a=RoomRegistGuide;if(html5Test.transition){a.registBox.removeClass("show")}else{a.registBox.animate({height:"0px"},500)}},showRegistGuideBox:function(){var c=RoomRegistGuide;var b=LoginUtil.isLogin();if(!b){var d=liveplayer.pageInfo.anchorInfo.logo;var a=liveplayer.pageInfo.anchorInfo.nick;if(a){if(a.length>10){a=a.substring(0,10)+"..."}$("#anchor-nick-span").html(a)}if(d){$("#regist-header-img1").attr("src",d);$("#regist-header-img2").attr("src",d)}RoomRegistGuide.suitSize();if(html5Test.transition){c.registBox.addClass("show")}else{c.registBox.animate({height:"226px"},500)}if(RoomStatistics){RoomStatistics.guideWinForRightBottom()}}},timeoutShowBox:function(){var a=RoomRegistGuide;window.setTimeout(function(){a.showRegistGuideBox()},a.showLowerRightCornerTime)}};var Turntable={templateRank:'<tr tabindex="-1"><td><i class="turnrank-row-index @index-class">@index</i></td><td><div class="turnrank-row-username">@userName</div></td><td><div class="turnrank-row-numcount">@numCount</div></td><td><div class="turnrank-row-gifticon"><img src="@giftIcon" width="32" height="32" /></div></td></tr>',myRankData:{},init:function(){Turntable.hadTurntable=false;Turntable.attentionElem=$("#turnrank-attention");Turntable.turnIconElem=$("#turntable-id");Turntable.turnRankBoxElem=$("#turnrank-box");Turntable.turnExchangeBoxElem=$("#exchange-box");Turntable.turnExchangeTotalYBElem=$("#exchange-box #totalYB");Turntable.turnLackRedBoxElem=$("#common-dialog-lack-red");Turntable.turnLackYBBoxElem=$("#common-dialog-lack-yb");Turntable.turnAlertBoxElem=$("#common-dialog-alert");Turntable.bindEvent();Turntable.turnIconElem.hide();weekStar.resizeToolbarButtons()},addListeners:function(){EntAppHandler.addEventListener(Events.ACT_TURNTABLE.SHOW_TREASURE_GRAB_RANK_BOX,Turntable.showRankBox);EntAppHandler.addEventListener(Events.ACT_TURNTABLE.SHOW_EXCHANGE_RED_DIAMOND_BOX,Turntable.showExchageBox);EntAppHandler.addEventListener(Events.ACT_TURNTABLE.SHOW_TURNTABLE_ICON,Turntable.showIcon);EntAppHandler.addEventListener(Events.ACT_TURNTABLE.RECEIVED_TURNTABLE_GIFT,Turntable.receivedTurnGift);EntAppHandler.addEventListener(Events.ACT_TURNTABLE.SHOW_LACK_RED_BOX,Turntable.showLackRedBox);EntAppHandler.addEventListener(Events.ACT_TURNTABLE.IS_LOGIN_FOR_RANK_BOX,Turntable.isLoginForRankBox);EntAppHandler.addEventListener(Events.ACT_TURNTABLE.RECEIVED_MY_RANK_DATA,Turntable.receivedMyRank)},bindEvent:function(){$("#turntable-id").click(function(){Turntable.showTurntable()});$("#turnrank-lottery").click(function(){Turntable.turnRankBoxElem.hide();Turntable.showTurntable()});Turntable.attentionElem.click(function(){var a=Turntable.attentionElem.hasClass("disabled");if(!a){Turntable.attention()}});$("#turnrank-close").click(function(){Turntable.turnRankBoxElem.hide()});Turntable.turnExchangeBoxElem.find(".exchange-num-controls a").each(function(){var a=$(this);a.click(function(){Turntable.turnExchangeBoxElem.find(".exchange-num-controls .selected").removeClass("selected");a.addClass("selected");var b=a.attr("data");Turntable.turnExchangeTotalYBElem.text(b)})});Turntable.turnExchangeBoxElem.find(".exchange-num-controls .other-exchange-num").focus(function(){var a=$(this);Turntable.turnExchangeBoxElem.find(".exchange-num-controls .selected").removeClass("selected");a.addClass("selected");a.val("")});Turntable.turnExchangeBoxElem.find(".exchange-num-controls .other-exchange-num").blur(function(){if(!Turntable.turnExchangeBoxElem.is(":hidden")){var d=$(this);var c=d.val();if(isNaN(c)){var b="请输入一个数字";Turntable.turnAlertBoxElem.find(".common-dialog-content").text(b);Turntable.turnAlertBoxElem.show();d.val("")}else{if(c){var a=Math.ceil((c*1)/1000);d.val(a*1000);Turntable.turnExchangeTotalYBElem.text(a)}else{d.val("其它")}}}});$("#exchange-submit").click(function(){var c=Turntable.turnExchangeTotalYBElem.text();if(c*1>0){var b=0;if(typeof pageInfo!="undefined"){b=pageInfo.ssid}Turntable.exchangeYToRG(c,b,function(e){if(e.resultCode==0){var g="兑换成功，请尽情享受幸运嘉年华吧！";var i=$("#userHadYB").text()*1;var d=i-c*1;var f=$("#userHadRed").text()*1;var h=f+c*1*1000;$("#userHadYB").text(d);$("#userHadRed").text(h);Turntable.turnAlertBoxElem.find(".common-dialog-content").text(g);Turntable.turnAlertBoxElem.show();Turntable.updateTurnRedDiamond(h)}else{if(e.resultCode==2){Recharge.showQrBox(c*1)}else{var g="兑换失败, 请稍后再试";Turntable.turnAlertBoxElem.find(".common-dialog-content").text(g);Turntable.turnAlertBoxElem.show()}}},function(){var d="兑换失败, 请稍后再试";Turntable.turnAlertBoxElem.find(".common-dialog-content").text(d);Turntable.turnAlertBoxElem.show()})}else{var a="请选择需要兑换的红钻数量";Turntable.turnAlertBoxElem.find(".common-dialog-content").text(a);Turntable.turnAlertBoxElem.show()}});$("#exchange-close").click(function(){Turntable.turnExchangeBoxElem.hide()});Turntable.turnLackRedBoxElem.find("#common-dialog-lack-red-close").click(function(){Turntable.turnLackRedBoxElem.hide()});$("#common-dialog-lack-red-exchange").click(function(){Turntable.turnLackRedBoxElem.hide();Turntable.showExchageBox()});Turntable.turnLackYBBoxElem.find("#common-dialog-lack-yb-close").click(function(){Turntable.turnLackYBBoxElem.hide()});Turntable.turnAlertBoxElem.find(".common-dialog-alert-close").click(function(){Turntable.turnAlertBoxElem.hide()})},initAttention:function(){var b=[];var a=0;if(typeof pageInfo!="undefined"&&pageInfo.anchorInfo&&pageInfo.anchorInfo.id){a=pageInfo.anchorInfo.id}b.push(a);AttentionUtil.isattention(b,function(e){if(e.code==0){var f=e.result;for(var d in f){if(d==a){var c=f[d]*1;Turntable.renderAttention(c)}}}})},renderAttention:function(a){if(a==1){Turntable.attentionElem.text("已关注");Turntable.attentionElem.addClass("disabled")}else{Turntable.attentionElem.text("关注主播");Turntable.attentionElem.removeClass("disabled")}},attention:function(){var a=pageInfo.anchorInfo.id;AttentionUtil.attention(a,function(b){if(b.code==0){Turntable.renderAttention(1)}})},receivedTurnGift:function(f){var a=[];for(var e=0;e<f.length;e++){var g=f[e];var c=g.id;var b=g.num;var d={giftId:c,addCount:b*1};a.push(d)}Gift.addPrepaidGift(a)},updateTurnRedDiamond:function(a){EntAppHandler.call(EntFns.ACT_ACT_TURNTABLE.UPDATE_TURNTABLE_RED,a)},showTurntable:function(){var a=LoginUtil.isLogin();if(a){EntAppHandler.call(EntFns.ACT_ACT_TURNTABLE.SHOW_TURNTABLE)}else{LoginUtil.showLoginOrRegister()}},receivedMyRank:function(a){var b=(a)?a.treasure_id:null;if(b){Turntable.myRankData[b]=a}},showRankBox:function(q){var l=LoginUtil.isLogin();if(l){var u={1:"turnrank-row-first",2:"turnrank-row-second",3:"turnrank-row-third"};var p=q.treasure_id;var m=decodeURI(q.from_name);var v=decodeURI(q.to_name);var j=q.gift_id;var k=q.grab_rank;var e=q.mem_count;var n=Gift.giftMap[j];var g=n.smallUrl;var a=q.gift_type;if(a==1){g="http://res.home.yystatic.com/images/show/common/new_red.png?v=909bfb3d"}var f=Turntable.sortRank(Turntable.concatMyRank(p,k));var s=LoginUtil.getLoginUid();$("#turnrank-count").text(e);$("#turnrank-headline").text("感谢 "+m+" 向 "+v+" 送出宝箱!");var h="";$("#turnrank-datalist tbody").empty();var b=4;for(var o=0;o<b&&o<f.length;o++){var t=Turntable.templateRank;var r=f[o];if(r.index<0){b++;continue}var d=o;if(r.uid==s){d=r.index}var c=u[d];if(!c){c=""}if(d>=4){d="4+"}t=t.replace("@index-class",c);t=t.replace("@index",d);t=t.replace("@numCount",r.grab_val);t=t.replace("@userName",decodeURI(r.uName));t=t.replace("@giftIcon",g);h+=t}Turntable.turnRankBoxElem.show();$("#turnrank-datalist tbody").html(h);Turntable.initAttention()}else{LoginUtil.showLoginOrRegister()}},concatMyRank:function(a,h){var d=UserContext.uid;for(var b=0;b<h.length;b++){var j=h[b];var e=j.uid;if(e==d){return h}}var g=Turntable.myRankData[a];if(g){var c=g.grab_val;var f=[{uid:d,grab_val:c,uName:UserContext.userNick}];delete Turntable.myRankData[a];return h.concat(f)}return h},sortRank:function(g){var b=[{index:-1,grab_val:Number.MAX_VALUE}];var c=LoginUtil.getLoginUid();for(var a=0;a<g.length;a++){var e=g[a];e.index=a+1;b[a+1]=e}b.sort(function(i,h){return h.grab_val-i.grab_val});for(var a=0;a<b.length;a++){var e=b[a];if(c==e.uid){var f=b[0];var d=b[a];f.index=-1;d.index=a;b[0]=d;b[a]=f;break}}return b},showIcon:function(b){var a=b.icon_url;var c=b.first_lottery;Turntable.renderFirstLotteryPoint(c);if(a){Turntable.renderTurnTableIcon(a);Turntable.hadTurntable=true}},showLackRedBox:function(){Turntable.turnLackRedBoxElem.show()},renderTurnTableIcon:function(a){a=decodeURIComponent(a);Turntable.turnIconElem.find(".icon").css("background-image",'url("'+a+'")');Turntable.turnIconElem.show()},renderFirstLotteryPoint:function(a){if(a==1){Turntable.turnIconElem.addClass("show-notice")}else{Turntable.turnIconElem.removeClass("show-notice")}},showExchageBox:function(){var a=LoginUtil.isLogin();if(a){Turntable.initExchange();Turntable.turnExchangeBoxElem.show()}else{LoginUtil.showLoginOrRegister()}},isLoginForRankBox:function(){var a=LoginUtil.isLogin();if(!a){LoginUtil.showLoginOrRegister()}return a},initExchange:function(){Turntable.getMoneyInfo(function(c){if(c){var f=c.diamond*1;var b=c.diamondQuan*1;var e=c.actDiamond*1;var d=f;var a=c.yyMoney*1;$("#userHadRed").text(d);$("#userHadYB").text(a)}})},getMoneyInfo:function(a){$.ajax({url:domain+"/ent/pay/getMyMoneyInfo.action",type:"post",dataType:"json",data:{},success:function(b){if(a){a(b)}}})},exchangeYToRG:function(a,c,e,d){var b=LoginUtil.isLogin();if(b){$.ajax({url:domain+"/ent/pay/exchangeYToRG.action",type:"post",data:{yb:a,channel:c},dataType:"json",success:function(f){if(e){e(f)}},error:function(f){console.log(f);if(d){d()}}})}else{LoginUtil.showLoginOrRegister()}}};$(document).ready(function(){Turntable.init()});