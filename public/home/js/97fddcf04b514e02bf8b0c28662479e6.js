function Attention(a){this.load=false;this.attentionedMap={};this.attentionListener=null;$.extend(this,a)}Attention.prototype={attention:function(a,c){if(!LoginUtil.isLogin()){LoginUtil.showLoginOrRegister();return}var b=this;$.ajax({url:domain+"/ent/user/attention.action",data:{objectId:a,mt:LoginUtil.getMt()},dataType:"json",autoAlert:true,success:function(d){if(d=="0"){if(c){c()}b.attentionedMap[a]=true;b.callAllAttentionListener(a)}else{if(d=="-99999"){b.popMessage("登陆状态过期，请重新登录!");LoginUtil.logout()}else{if(d=="2"||d=="1"){b.popMessage("服务器繁忙，关注失败，请重新关注。")}}}}})},unAttention:function(a,c){if(!LoginUtil.isLogin()){return}var b=this;$.ajax({url:domain+"/ent/user/unAttention.action",data:{objectId:a,mt:LoginUtil.getMt()},dataType:"json",autoAlert:true,success:function(d){if(d=="-99999"){b.popMessage("登陆状态过期，请重新登录!");LoginUtil.logout();return}b.attentionedMap[a]=false;if(c){c()}}})},loadAttentionedMap:function(a){if(!LoginUtil.isLogin()){return}if(!this.load){this.getAttentionList(a)}},getAttentionList:function(b){if(!LoginUtil.isLogin()){return}var a=this;$.ajax({url:domain+"/ent/user/getAttentionList.action?v="+new Date(),data:{},dataType:"json",autoAlert:true,success:function(c){if(0!=c.result){return}a.load=true;var d=c.data.list||null;if(!d||0>=d.length){return}$.each(d,function(f,g){a.attentionedMap[g]=true});if(b){b(c.data.list)}}})},popMessage:function(a){new ShowDialog.POPUP({width:200,content:a,timeout:true})},addAttentionListener:function(a){if(!$.isFunction(a)){console.log("attentionListener,param is wrong! "+a+" is not a function");return}if(!this.attentionListener){this.attentionListener=[]}this.attentionListener.push(a)},callAllAttentionListener:function(a){if(!this.attentionListener){return}for(var b in this.attentionListener){this.attentionListener[b](a)}},setUnLoad:function(){this.load=false;this.attentionedMap={}}};window.attention=new Attention({});function RoomNoble(a){this.vipListContainer=$("#vip-list");this.nobleScrollarea=$("#vip-list-div .w-vipList-scrollarea");this.vipListDiv=$("#vip-list-div");this.roomNobleMap={};this.renderNobleList=[];this.total=0;this.pageIndex=0;this.pageSize=30;this.hasResp=true;$.extend(this,a);this.isNobleDivInit=false;this.hasDataFromFlash=false;this.httpNobleData=[];this.isHttpDataInDiv=false;this.myNobleTimer=null;this.scrollObj=null;this.hadShowUpgrage=false;this.timeoutId=0}RoomNoble.prototype={init:function(){this.bindEvent();LoginUtil.addLoginCallbacks(roomNoble.loginCallback4Dedicate);LoginUtil.addLogoutCallbacks(roomNoble.logoutCallback4Dedicate);LoginUtil.addShowUserInfoCallbacks(roomNoble.renderMyNobleInfoCallBack);roomNoble.getDataFromHttp()},logoutCallback4Dedicate:function(){attention.setUnLoad();roomNoble.reRenderNoble();var a="";a+='开通贵族送红钻，续费更返110%！<a href="javascript:void(0);" class="btn" title="开通贵族" id="open-noble-btn">开通贵族</a>';$("#my-noble-div").removeClass("renew").empty().html(a);$(".ent-content #contribution-noble #open-noble-btn").unbind("click").click(function(){roomNoble.showNobleBox()})},loginCallback4Dedicate:function(){roomNoble.reRenderNoble()},scrollEnd:function(){if(0>=roomNoble.renderNobleList.length){roomNoble.getNextBatchNobleList();return}if(roomNoble.isHttpDataInDiv){roomNoble.vipListContainer.empty();roomNoble.pageIndex=0}if(roomNoble.pageIndex<roomNoble.renderNobleList.length){var b=roomNoble.renderNobleList.slice(roomNoble.pageIndex,roomNoble.pageIndex+roomNoble.pageSize);roomNoble.pageIndex+=b.length;var a=roomNoble.renderer(b);roomNoble.vipListContainer.append(a);roomNoble.scrollObjResize();roomNoble.bindEventAfterRender()}else{if(roomNoble.renderNobleList.length<roomNoble.total){roomNoble.getNextBatchNobleList()}}},scrollObjResize:function(){if(!roomNoble.scrollObj){return}roomNoble.scrollObj.resize();var e=parseInt(roomNoble.vipListDiv.find(".head").css("height"));var a=parseInt(roomNoble.vipListContainer.find("li:eq(0)").css("height"));var c=a*roomNoble.vipListContainer.find("li").length;var b=a*10-e;var d=a*3-e;if(0==c||c>b){c=b}if(c<d){c=d}var f=c+e;roomNoble.vipListContainer.css({height:c+"px"});roomNoble.vipListContainer.parent().parent().css({height:c+"px"});$("#bangCntGbx").css({height:f+"px"});roomNoble.nobleScrollarea.css({height:c+"px"})},showNobleBox:function(a){if(!a){a=2}if(LoginUtil.isLogin()){if(!liveplayer.pageInfo){new ShowDialog.POPUP({width:200,content:"获取主播信息失败！",timeout:true});return}if(liveplayer.pageInfo.anchorInfo.yynum){window.roomNoble.openNoble(liveplayer.pageInfo.anchorInfo.yynum,a,300,UserContext.uid,liveplayer.pageInfo.sid,liveplayer.pageInfo.ssid)}else{new ShowDialog.POPUP({width:200,content:"首麦无人",timeout:true})}}else{LoginUtil.showLoginOrRegister()}},bindEvent:function(){var a=this;$(window).on("resize",function(){setTimeout(function(){try{roomNoble.scrollObjResize()}catch(b){console.log(b)}},250)})},bindEventAfterRender:function(){$(".ent-content #contribution-noble #vip-list a.follow").unbind("click").click(function(){var b=$(this);var a=b.attr("objectNum")||"0";attention.attention(a,function(){b.parent().parent().append('<div class="button"><span>已关注</span></div>');b.parent().remove();if(RoomStatistics){RoomStatistics.attentionSuccess("2")}})});roomNoble.vipListDiv.unbind("mouseover").mouseover(function(){roomNoble.nobleScrollarea.show();if(!roomNoble.scrollObj){return}roomNoble.scrollObj.resize()}).unbind("mouseleave").mouseleave(function(){roomNoble.nobleScrollarea.hide();if(!roomNoble.scrollObj){return}roomNoble.scrollObj.resize()})},isNoble:function(a){return !!roomNoble.roomNobleMap[a]},getNobleLevel:function(a){if(roomNoble.isNoble(a)){return roomNoble.roomNobleMap[a].grade}return 0},getNextBatchNobleList:function(){if(roomNoble.hasResp){roomNoble.hasResp=false;EntAppHandler.call("call_noble_next_page")}else{console.log("上次请求还没有响应，这次不发起请求！")}},respNoble:function(d){roomNoble.hasResp=true;var c=parseInt(d.count)||0;roomNoble.total=c||roomNoble.renderNobleList.length;var a=d.nobleList||[];var b=d.nobleLeave||[];if((!a||!a.length)&&(!b||!b.length)){return}roomNoble.hasDataFromFlash=true;if(0<a.length){$.each(a,function(e,f){f.icon=f.icon||"http://s5.yy.com/guild/header/10001.jpg";roomNoble.roomNobleMap[f.uid]=f})}if(0<b.length){$.each(b,function(e,f){delete roomNoble.roomNobleMap[f.uid]})}if($("#wLiveplayerBangArea .w-liveplayer-tabArea-hd a:eq(0)").hasClass("current")){roomNoble.reRenderNoble()}},initRender:function(d){if(roomNoble.isNobleDivInit){return}attention.loadAttentionedMap(function(){roomNoble.reRenderNoble()});var b=[];for(var a in roomNoble.roomNobleMap){b.push(roomNoble.roomNobleMap[a])}roomNoble.sortNobleList(b);roomNoble.renderNobleList=b;roomNoble.pageIndex=0;var f=roomNoble.getNobleList();roomNoble.pageIndex+=f.length;var c=roomNoble.renderer(f);var c='<div class="module-box billboard" id="contribution-noble" style="position:relative;height:inherit;"><div class="vip-list" id="vip-list-div" style="position:relative;height:100%;"><div class="head" id="my-noble-div" style="position:relative;z-index:1;display:none">开通贵族送红钻，续费更返110%！<a href="javascript:void(0);" class="btn" title="开通贵族" id="open-noble-btn">开通贵族</a></div><div class="body" style="position:relative;"><div id="vip-list-scroll" style="overflow: hidden;position:relative;top: 2px;height:100%;"><ul id="vip-list" style="position:relative;overflow: hidden;height:100%;">'+c+'</ul><div class="w-vipList-scrollarea w-liveplayer-scrollarea" style="position:absolute;top:0px;height: 100%;width: 12px;right:0;display: none;"><a href="javascript:void(0);" class="w-vipList-scrollbar w-live-scrollbar w-liveplayer-scrollbar" style="height: 100%;display:block;position: absolute;"></a></div></div></div><div class="tips" id="nobleUpgrage"><i class="icon noble-x50 noble-5"></i><div class="text"><span class="nick ellipsis" id="nobleNick">贡丸乀吾魄"『护狼团』</span><br><span class="ellipsis" id="nobleLevel">荣升男爵Lv20</span></div><div class="flash"></div></div></div></div>';$("#"+d).empty().html(c);roomNoble.postInitRender();var e=this;$(".ent-content #contribution-noble #open-noble-btn").unbind("click").click(function(){e.showNobleBox()});roomNoble.bindEventAfterRender();roomNoble.isNobleDivInit=true},requestMyNobleInfo:function(){EntAppHandler.call("requestMynobleInfo")},myNobleInfoResponse:function(b){console.log("myNobleInfoResponse");console.log(b);UserContext.nobleLevel=b.nobelLevel;if(UserContext.nobleLevel>0){UserContext.isNoble="true"}else{return}UserContext.honourLevel=b.honourLevel;var c={};c.nobleLevel=UserContext.nobleLevel;c.honourLevel=UserContext.honourLevel;c.isNoble=UserContext.isNoble;if(b.toUnValidTime>0){var a=new Date().getTime()+b.toUnValidTime*1000;c.nobleExpDate=new Date(a)}else{c.nobleState=2}console.log(c);roomNoble.renderMyNobleInfo(c)},nobleLevelUpgrade:function(a){var b=a.levelUpgradeType;if(b==0){return}a.isUngrade=true;a.userName=a.extend.nick;roomNoble.showNobleTips(a)},openNobleBC:function(a){a.isUngrade=false;a.nobelLevel=a.nobleLevel;roomNoble.showNobleTips(a)},showNobleTips:function(d){var a=roomNoble.getNobleTypeByLevel(parseInt(d.nobelLevel));var b="";if(d.isUngrade){b="荣升"+a+"Lv"+d.honourLevel}else{b="荣升"+a}clearTimeout(roomNoble.timeoutId);roomNoble.timeoutId=0;$("#nobleUpgrage").empty();var c='<i class="icon noble-x50 noble-'+d.nobelLevel+'"></i><div class="text"><span class="nick ellipsis" id="nobleNick">'+d.userName+'</span><br><span class="ellipsis" id="nobleLevel">'+b+'</span></div><div class="flash"></div>';$("#nobleUpgrage").html(c);$(".ent-content .vip-list .tips").animate({top:"36px"},200,null,function(){var e=$(this);$(this).addClass("active").children(".flash").css("visibility","visible").animate({left:"100%"},2000,null,function(){$(this).css({left:"-89px",visibility:"hidden"});roomNoble.timeoutId=window.setTimeout(function(){e.removeClass("active").css("top","");console.log("IE  ..roomNoble.timeoutId"+roomNoble.timeoutId+"setTimeout")},5000);console.log("IE  ..roomNoble.timeoutId"+roomNoble.timeoutId)})})},getNobleTypeByLevel:function(a){switch(a){case 7:return"勋爵";case 6:return"男爵";case 5:return"子爵";case 4:return"伯爵";case 3:return"侯爵";case 2:return"公爵";case 1:return"国王";default:break}},renderMyNobleInfoCallBack:function(a){if(roomNoble.isNobleDivInit){roomNoble.renderMyNobleInfo(a)}else{roomNoble.myNobleTimer=window.setInterval(function(){if(roomNoble.isNobleDivInit){roomNoble.renderMyNobleInfo(a);window.clearTimeout(roomNoble.myNobleTimer)}},1000)}},renderMyNobleInfo:function(c){if(c.isNoble=="true"){var d="LV"+c.honourLevel;if(c.nobleExpDate){var e=new Date(c.nobleExpDate);var a=new Date();if(e<a){d="已过期"}}else{if(c.nobleState&&c.nobleState==2){d="已过期"}}var b="";b+='<i class="noble noble-'+c.nobleLevel+'"></i>';b+='<i class="icon cherish-level">'+d+"</i>";b+='<a class="nick ellipsis" href="http://www.yy.com/u/'+UserContext.yyNum+'" target="_blank" title="'+UserContext.userNick+'">'+UserContext.userNick+"</a>";b+='<a href="javascript:void(0);" class="btn" title="续费贵族" id="open-noble-btn">续费贵族</a>';$("#my-noble-div").addClass("renew").empty().html(b);$(".ent-content #contribution-noble #open-noble-btn").unbind("click").click(function(){roomNoble.showNobleBox()})}$("#my-noble-div").show()},postInitRender:function(){roomNoble.vipListContainer=$("#vip-list");roomNoble.nobleScrollarea=$("#vip-list-div .w-vipList-scrollarea");roomNoble.vipListDiv=$("#vip-list-div");this.vipListScrollPane=$("#vip-list-scroll");roomNoble.scrollObj=analogscroll(roomNoble.vipListContainer,{scrollbar:roomNoble.nobleScrollarea,onend:roomNoble.scrollEnd,distance:5,endDistance:40});roomNoble.scrollObjResize()},getNobleList:function(){if(roomNoble.hasDataFromFlash){roomNoble.total=roomNoble.total||roomNoble.renderNobleList.length;roomNoble.total=roomNoble.total<roomNoble.renderNobleList.length?roomNoble.renderNobleList.length:roomNoble.total;var a=roomNoble.renderNobleList.slice(roomNoble.pageIndex,roomNoble.pageIndex+roomNoble.pageSize);return a}else{console.log("use http noble data!");roomNoble.isHttpDataInDiv=true;roomNoble.total=roomNoble.total||roomNoble.httpNobleData.length;return roomNoble.httpNobleData}return[]},reRenderNoble:function(){var b=[];for(var a in roomNoble.roomNobleMap){b.push(roomNoble.roomNobleMap[a])}roomNoble.sortNobleList(b);roomNoble.renderNobleList=b;roomNoble.pageIndex=0;var d=roomNoble.getNobleList();roomNoble.pageIndex+=d.length;var c=roomNoble.renderer(d);roomNoble.vipListContainer.empty().html(c);roomNoble.scrollObjResize();roomNoble.bindEventAfterRender()},renderer:function(b){var a="";if(!b){return a}var c='<li><div class="info">%`attentionTab`%</div><div class="user ellipsis"><i class="noble noble-%`grade`%"></i><a class="nick" href="%`personSiteUrl`%" target="_blank" title="%`nick`%">%`nick`%</a></div></li>';$.each(b,function(i,k){var e=decodeURIComponent(k.nick||"");var j=k.grade||0;var h=k.yynum||"";var g="http://www.yy.com/u/"+h;var d='<div class="button"><span>已关注</span></div>';if(!attention.attentionedMap[h]){d='<div class="button follow-button-ctr"><a class="btn follow" objectNum="'+h+'">关注</a></div>'}if(window.combineFlag){d='<div class="button"><span></span></div>'}var f=c.replace(/%`nick`%/ig,e).replace(/%`grade`%/ig,j).replace(/%`personSiteUrl`%/ig,g).replace(/%`attentionTab`%/ig,d);a+=f});return a},getDataFromHttp:function(){var a=pageInfo.sid==undefined?0:pageInfo.sid;var b=pageInfo.ssid==undefined?0:pageInfo.ssid;$.ajax({url:domain+"/ent/room/queryNoble.action",data:{topCid:a,subCid:b,offset:0,limit:4},dataType:"json",success:function(d){if(!d||0!=d.result||!d.data||!d.data.nobleList||0>=d.data.nobleList.length){return}var c=d.data.nobleList;roomNoble.httpNobleData=c;if(0<$("#bangCntGbx").length&&(!roomNoble.isNobleDivInit||(roomNoble.isNobleDivInit&&!roomNoble.hasDataFromFlash))){console.log("try to use http noble data");roomNoble.initRender("bangCntGbx")}else{console.log("no need to use http noble data")}}})},sortNobleList:function(c){if(!c){return[]}var a=0;var b=false;if(LoginUtil.isLogin()){a=LoginUtil.getLoginUid();b=true}c.sort(function(k,i){if(b){if(k.uid==a){return -1}if(i.uid==a){return 1}}var g=parseInt(k.hasSeat)||0;var f=parseInt(i.hasSeat)||0;var m=parseInt(k.grade)||9999999;var l=parseInt(i.grade)||9999999;var j=parseInt(k.productTotalValues)||0;var h=parseInt(i.productTotalValues)||0;var e=parseInt(k.curHonour)||0;var d=parseInt(i.curHonour)||"0";if(g>f){return -1}else{if(g<f){return 1}else{if(m<l){return -1}else{if(m>l){return 1}else{if(j>h){return -1}else{if(j<h){return 1}else{if(e>d){return -1}else{if(e<d){return 1}}}}}}}}return 0});return c},getNobles:function(){return roomNoble.renderNobleList},getNoble:function(a){return roomNoble.roomNobleMap(a)},openNoble:function(b,e,f,d,c,a){showNobleDialog(b,e,f,d,c,a)},adapt:function(){}};window.roomNoble=new RoomNoble();roomNoble.init();function showNobleDialog(b,e,g,d,c,a){if(!e){e=2}var f="http://m.yy.com/earn/noble/v2/noble-priv-tab-v3.html?agentId="+b+"&c="+e+"&source=1&partner=0&guard=0&userId="+d+"&topId="+c+"&subId="+a+"&joint=2";window.noblePop=new ShowDialog.POPUP({width:0,height:0,content:'<div id="nobleDiv" class="open-noble-div"><iframe id="nobleIframe" src="'+f+'" width="800px" height="580px" style="border:none;background: transparent;border-radius: 5px;"></iframe></div>',yourClass:"popup-noble"});changeNobleCSS()}function changeNobleCSS(){$(".popup-noble .popup-box").css({width:"0px",height:"0px","margin-left":"-500px","margin-top":"-320px"})}function closeNoble(){window.noblePop.removePop()}function closeNobleDialog(){$("#nobleIframe").attr("src","");$.uiwidget.popupHide({id:"nobleDiv"})}function getData(){$.getJSON("http://res.home.yystatic.com/json/show/index/live1.json",function(){alert(1)});$.ajax({dataType:"json",url:"/json/show/index/live1.json?v=3",data:{},success:function(a){console.log(1)}})};function Dedicate(a){this.rankContainer=$("#contribute-list");this.scrollarea=$(".billboard .w-contribution-scrollarea");this.contributionListDiv=$("#contribution-list-div");this.hasPrevPage=0;this.hasNextPage=1;this.pageIndex=0;this.pageSize=15;this.contributeMap={};this.rankList=[];this.total=0;this.hasResp=true;$.extend(this,a);this.isDedicateDivInit=false;this.hasDataFromFlash=false;this.httpDedicateData=[];this.isHttpDataInDiv=false;this.scrollObj=null;this.top10YYNumStr=null;this.yyNumToRankNumMap=null}Dedicate.prototype={init:function(){dedicate.bindEvent();LoginUtil.addLoginCallbacks(dedicate.loginCallback4Dedicate);LoginUtil.addLogoutCallbacks(dedicate.logoutCallback4Dedicate);dedicate.getDataFromHttp()},logoutCallback4Dedicate:function(){attention.setUnLoad();dedicate.reRrenderRank()},loginCallback4Dedicate:function(){dedicate.reRrenderRank()},scrollEnd:function(){if(0>=dedicate.rankList.length){dedicate.nextPage();return}if(dedicate.isHttpDataInDiv){dedicate.rankContainer.empty();dedicate.pageIndex=0}if(dedicate.pageIndex<dedicate.rankList.length){var b=dedicate.rankList.slice(dedicate.pageIndex,dedicate.pageIndex+dedicate.pageSize);var a=dedicate.renderer(b);dedicate.pageIndex+=b.length;dedicate.rankContainer.append(a);dedicate.bindEventAfterRender();dedicate.scrollObjResize()}else{if(dedicate.rankList.length<dedicate.total){dedicate.nextPage()}}},scrollObjResize:function(){if(!dedicate.scrollObj){return}dedicate.scrollarea.css("height",dedicate.rankContainer.css("height"));dedicate.scrollObj.resize();var a=parseInt(dedicate.rankContainer.find("li:eq(0)").css("height"));var d=a*dedicate.rankContainer.find("li").length;var c=a*10;var f=a*3;if(0==d||d>c){d=c}if(d<f){d=f}dedicate.rankContainer.css({height:d+"px"});$("#bangCntGxb").css({height:d+"px"});var b=parseInt($("#contribute-con .w-contribution-scrollarea").css("height"));var g=parseInt($("#contribute-con .w-contribution-scrollbar").css("height"));var e=Math.abs(b-g)<5;var h=dedicate.pageIndex>=dedicate.total;if(e&&(dedicate.isHttpDataInDiv||h)){$("#contribute-con .w-contribution-scrollarea").hide()}else{$("#contribute-con .w-contribution-scrollarea").show()}},bindEvent:function(){$(window).on("resize",function(){try{setTimeout(function(){dedicate.scrollObjResize()},250)}catch(a){console.log(a)}})},bindEventAfterRender:function(){$("#contribution-noble #contribute-list li a.follow").unbind("click").click(function(){var b=$(this);var a=b.attr("objectNum")||"0";attention.attention(a,function(){b.parent().parent().append('<div class="button"><span>已关注</span></div>');b.parent().remove();if(RoomStatistics){RoomStatistics.attentionSuccess("2")}})});$("#contribution-noble").unbind("mouseover").mouseover(function(){dedicate.contributionListDiv.addClass("hover");dedicate.scrollarea.show();dedicate.scrollObjResize()}).unbind("mouseleave").mouseleave(function(){dedicate.scrollarea.hide();dedicate.contributionListDiv.removeClass("hover")})},ready:function(a){},receiveContribute:function(f){var h=parseInt(f.minType||2);if(2==h){dedicate.hasResp=true}var d=f.data;if(!d||0>=d.length){return 0}var e=dedicate.hasDataFromFlash;dedicate.hasDataFromFlash=true;dedicate.total=f.total||d.length;for(var c=0;c<d.length;c++){var g=d[c];dedicate.contributeMap[g.rankNum]=g}if(!dedicate.yyNumToRankNumMap){dedicate.setYyNumToRankNumMap(dedicate.contributeMap)}if(!dedicate.top10YYNumStr){dedicate.setTop10YYNumStr(dedicate.contributeMap)}var b=dedicate.top10ChangeFlag(dedicate.contributeMap);if($("#wLiveplayerBangArea .w-liveplayer-tabArea-hd a:eq(1)").hasClass("current")){var a=e&&(2==h);dedicate.reRrenderRank(a)}if(b){dedicate.setYyNumToRankNumMap(dedicate.contributeMap)}},resetContribute:function(a){},prevResult:function(a){dedicate.hasPrevPage=a.result||0},nextResult:function(a){dedicate.hasNextPage=a.result||0},prePage:function(){if(dedicate.hasResp){dedicate.hasResp=false;EntAppHandler.call(Events.CONTRIBUTE.PREV_PAGE)}else{console.log("上次请求还没有响应，这次不发起请求！")}},nextPage:function(){if(dedicate.hasResp){dedicate.hasResp=false;EntAppHandler.call(Events.CONTRIBUTE.NEXT_PAGE)}else{console.log("上次请求还没有响应，这次不发起请求！")}},sortRankList:function(a){if(!a){return[]}a.sort(function(c,b){var e=c.rankNum||0;var d=b.rankNum||0;if(e<d){return -1}else{if(e>d){return 1}}return 0});return a},initRender:function(c){dedicate.cleanTop10Flag();dedicate.isDedicateDivInit=true;attention.loadAttentionedMap(function(){dedicate.reRrenderRank(false)});dedicate.rankList=[];for(var b in dedicate.contributeMap){dedicate.rankList.push(dedicate.contributeMap[b])}dedicate.sortRankList(dedicate.rankList);dedicate.pageIndex=0;var d=dedicate.getDedicateList(false);var a=dedicate.renderer(d);dedicate.pageIndex=d.length;var a='<div class="module-box billboard" id="contribution-noble" style="height:inherit;"><div class="contribution-list hover" id="contribution-list-div"><div id="contribute-con" style="overflow: hidden;position:relative;top: 2px;"><ul id="contribute-list" style="overflow: hidden;">'+a+'</ul><div class="w-contribution-scrollarea w-liveplayer-scrollarea" style="position:absolute;top:0px;height: 100%;width: 12px;right:0;display: none;"><a href="javascript:void(0);" class="w-contribution-scrollbar w-live-scrollbar w-liveplayer-scrollbar" style="height: 100%;display:block;position: absolute;"></a></div></div><div class="shadow-mask"></div></div></div>';$("#"+c).empty().html(a);dedicate.postInitRender();dedicate.bindEventAfterRender()},postInitRender:function(){this.rankContainer=$("#contribute-list");this.scrollarea=$(".billboard #contribute-con .w-contribution-scrollarea");this.contributionListDiv=$("#contribution-list-div");this.scrollPane=$("#contribute-con");dedicate.scrollObj=analogscroll(dedicate.rankContainer,{scrollbar:dedicate.scrollarea,onend:dedicate.scrollEnd,distance:5,endDistance:0});dedicate.scrollObjResize();dedicate.cleanTop10Flag();dedicate.setTop10YYNumStr(dedicate.contributeMap);dedicate.setYyNumToRankNumMap(dedicate.contributeMap)},reRrenderRank:function(c){attention.loadAttentionedMap(function(){dedicate.reRrenderRank(false)});dedicate.rankList=[];for(var b in dedicate.contributeMap){dedicate.rankList.push(dedicate.contributeMap[b])}dedicate.sortRankList(dedicate.rankList);var e=dedicate.getDedicateList(c);var a=dedicate.renderer(e);var d=dedicate.pageIndex;dedicate.pageIndex=e.length;dedicate.rankContainer.empty().html(a);dedicate.scrollObjResize();if(c){dedicate.scrollObj.scrollTo(d*34)}dedicate.bindEventAfterRender()},getDedicateList:function(a){if(dedicate.hasDataFromFlash){var b=0;if(a){b=dedicate.pageIndex+dedicate.pageSize}else{dedicate.pageIndex=0;b=dedicate.pageSize}dedicate.isHttpDataInDiv=false;return dedicate.rankList.slice(0,b)}else{console.log("use http dedicate data!");dedicate.isHttpDataInDiv=true;return dedicate.httpDedicateData}return[]},renderer:function(a){var b="";if(!a){return b}var c='<li><div class="info"><div class="fortune"><i class="red-diamond"></i>%`consume`%</div>%`attentionTab`%</div><div class="user"><i class="order order-%`rankNum`%">%`rankNum`%</i><span class="nick ellipsis">%`nobleTab`%<a href="%`personSiteUrl`%" target="_blank" title="%`nick`%">%`nick`%</a></span>%`upgradeArrow`%</div></li>';$.each(a,function(l,q){var n=q.rankNum;var e=decodeURIComponent(q.nick||"");var k=q.yyNum||"";var i=q.userType||3;var o=q.userLevel||0;if(UserContext&&k==UserContext.yyNum){if(UserContext.nobleLevel){o=UserContext.nobleLevel}}var h=q.consume||0;var m="http://www.yy.com/u/"+k;var d="";if(2==i){d='<i class="noble noble-'+o+'"></i>'}var f='<div class="button"><span>已关注</span></div>';if(!attention.attentionedMap[k]){f='<div class="button follow-button-ctr"><a class="btn follow" objectNum="'+k+'">关注</a></div>'}f="";if(window.combineFlag){f='<div class="combine"><i class="red-diamond"></i>'+h+"</div>"}var g="";var j=dedicate.yyNumToRankNumMap&&(n<=10)&&(n<(dedicate.yyNumToRankNumMap[k]||0));if(j){g='<i class="arrow"><span class="top"></span><span class="bot"></span></i>'}var p=c.replace(/%`rankNum`%/ig,n).replace(/%`nick`%/ig,e).replace(/%`upgradeArrow`%/ig,g).replace(/%`nobleTab`%/ig,d).replace(/%`attentionTab`%/ig,f).replace(/%`userLevel`%/ig,o).replace(/%`consume`%/ig,h).replace(/%`personSiteUrl`%/ig,m);b+=p});return b},getDataFromHttp:function(){var a=pageInfo.sid==undefined?0:pageInfo.sid;var b=pageInfo.ssid==undefined?0:pageInfo.ssid;$.ajax({url:domain+"/ent/room/queryDedicate.action",data:{topCid:a,subCid:b,offset:0,limit:4},dataType:"json",success:function(c){if(!c||0!=c.result||!c.data||!c.data.dedicatList||0>=c.data.dedicatList.length){return}var d=c.data.dedicatList;dedicate.httpDedicateData=d;if(0<$("#bangCntGxb").length&&(!dedicate.isDedicateDivInit||(dedicate.isDedicateDivInit&&!dedicate.hasDataFromFlash))){console.log("try to use http dedicate data");dedicate.initRender("bangCntGxb")}else{console.log("no need to use http dedicate data")}}})},adapt:function(){},setTop10YYNumStr:function(b){var e=[];for(var c in b){if(parseInt(c)>10){continue}e.push(b[c])}dedicate.sortRankList(e);var d="";for(var a=0;a<e.length;a++){d+=e[a].yyNum}dedicate.top10YYNumStr=d},top10ChangeFlag:function(b){if(!$("#wLiveplayerBangArea .w-liveplayer-tabArea-hd a:eq(0)").hasClass("current")&&dedicate.hasTop10Flag()){return false}var e=[];for(var c in b){if(parseInt(c)>10){continue}e.push(b[c])}dedicate.sortRankList(e);var d="";for(var a=0;a<e.length;a++){d+=e[a].yyNum}if(d!=""&&d===dedicate.top10YYNumStr){dedicate.cleanTop10Flag();return false}else{$("#bangTabGxb").addClass("warning");dedicate.top10YYNumStr=d;return true}},setYyNumToRankNumMap:function(a){dedicate.yyNumToRankNumMap={};for(var b in a){dedicate.yyNumToRankNumMap[a[b].yyNum]=a[b].rankNum}},hasTop10Flag:function(){return $("#bangTabGxb").hasClass("warning")},cleanTop10Flag:function(){$("#bangTabGxb").removeClass("warning")}};window.dedicate=new Dedicate({});dedicate.init();var Gift={giftMap:{},m_giftIds:[],weekStarGiftMap:{},freeGiftMap:{},freeGifIds:[],prepaidGiftMap:{},prepaidGifIds:[],paidGiftMap:{},paidGiftIds:[],isBigGiftMap:{},prepaidCfgGifs:[],freeCfgGifts:[],userPrepaidGift:[],userFreeGift:[],week_winnerMap:{},package_week_winnerMap:{},numLevel:[10,30,66,188,520,1314],isGiftModuleReady:false,currentSelectGift:null,isInitPackageImgHeight:false,opening:0,moreNumSize:0,giftInputNum:$("#giftInputNum"),moreNumSelect:$("#more-num-select"),numExtend:$("#gift-select-list-id"),numSelect:$(".option-list"),giveBtn:$("#sendGiftBtn"),rechargeBtn:$("#gift-recharge-btn"),$giftSubmit:null,max:1314,packageGiftMax:99999,tipsTarget:null,userObject:{},payConfirmModule:$("#pay-confirm-module-id"),closePayConfirm:$("#close-pay-confirm-id"),payConfirm:$("#pay-confirm"),payContext:$("#pay-context"),userChoise:2,payData:null,isChrome:null,preType:0,freeType:1,weekStarType:2,paidType:3,giftReqUrl:"",giftTabIndex:0,packageTabIndex:0,giftHeight:0,isPaidTab:true,init:function(){var a=Gift;$("body").unbind("click").bind("click",function(){if(a.isShowSelect()){a.moreNumSelect.trigger("click")}if(a.opening!=0){if(a.opening==1){$("#more-paid-gifts").trigger("click")}else{if(a.opening==2){$("#more-package-gifts").trigger("click")}}a.opening=0}});LoginUtil.addLoginCallbacks(Gift.login);LoginUtil.addLogoutCallbacks(Gift.logout);a.initGift()},login:function(){var a=Gift;a.initGift()},logout:function(){var a=Gift;a.isGiftModuleReady=false;$("#package-gifts-wrap li").addClass("disabled");$("#package-gifts-wrap li .amount .num").html(0);$("#package-gifts-wrap li .amount .num").parent().addClass("hide");for(var b in a.freeGiftMap){a.freeGiftMap[b].count=0;$("#package-gifts-wrap li#"+b).hide()}for(var b in a.prepaidGiftMap){a.prepaidGiftMap[b].count=0;$("#package-gifts-wrap li#"+b+" a img").addClass("grayscale")}a.addGrayscale();a.giftTabIndex=0;a.packageTabIndex=0;a.resizeFirstRow(false);a.resizeFirstRow(true);a.defaultSelectGift()},bindEvent:function(){var a=Gift;a.giveBtn.unbind("click").bind("click",function(b){b.stopPropagation();if(a.isShowSelect()){a.moreNumSelect.trigger("click")}if(a.opening!=0){if(a.opening==1){$("#more-paid-gifts").trigger("click")}else{if(a.opening==2){$("#more-package-gifts").trigger("click")}}a.opening=0}try{a.sendGift()}catch(c){console.log("Exception:"+c.message)}return false});a.rechargeBtn.unbind("click").bind("click",function(){if(!LoginUtil.isLogin()){LoginUtil.showLoginOrRegister();return}Recharge.recharge()});a.closePayConfirm.unbind("click").bind("click",function(){a.payConfirmModule.hide()});$("#pay-repeat").unbind("click").bind("click",function(){$(this).toggleClass("checked");if(a.userChoise!=2){a.userChoise=2}else{a.userChoise=1}});a.payConfirm.unbind("click").bind("click",function(){a.payConfirmModule.hide();a.payData.userChoice=a.userChoise;Gift.payComfirm(a.payData)});a.bindGiftList();a.bindInputArea();a.defaultSelectGift()},defaultSelectGift:function(){var a=Gift;$("#paid-gifts-wrap").find("li:eq(0)").trigger("click");a.giftInputNum.val(1)},clearGiftIds:function(){var a=Gift;a.m_giftIds=[];a.freeGifIds=[];a.prepaidGifIds=[];a.paidGiftIds=[];a.prepaidCfgGifs=[];a.freeCfgGifts=[];a.userPrepaidGift=[];a.userFreeGift=[];a.weekStarGiftMap={};a.prepaidGiftMap={};a.isBigGiftMap={};a.giftReqUrl="";a.isInitPackageImgHeight=false;a.giftTabIndex=0;a.packageTabIndex=0;if(a.isPaidTab){a.resizeFirstRow(false)}else{a.resizeFirstRow(true)}},initGift:function(a){var d=Gift;var c=[];var b=[];$.ajax(domain+"/ent/gift/giftConfigNewUrl.action",{dataType:"xml",data:{sid:pageInfo.sid,ssid:pageInfo.ssid,giftUrl:a},beforeSend:function(e){xhrObj=e;d.clearGiftIds()},success:function(h){h=$(h);var m=h.find("free");var f=m.children("item");$.each(f,function(t,v){var u={};v=$(v);u.isPaid=false;u.type=v.attr("FREE_PROPS_TYPE");u.name=v.attr("FREE_PROPS_NAME");u.price=v.attr("DWB_PROPS_PRICE");u.grade=v.attr("FREE_PROPS_GRADE");u.desc=v.attr("FREE_PROPS_DESCRIPTION");u.iconUrl=v.attr("PROPS_MOBILE_ICON_PATH");if(u.iconUrl==null){u.iconUrl=v.attr("FREE_PROPS_ICON")}u.gif=v.attr("FREE_PROPS_IMAGE");if(u.gif==null){u.gif=v.attr("FREE_PROPS_IMAGE2")}u.imageUrl=v.attr("FREE_PROPS_IMAGE");u.smallUrl=v.attr("FREE_PROPS_ICON");u.cornerMark=v.attr("PAID_PROPS_CORNER_MARK_PATH");u.bgImg=v.attr("PAID_PROPS_BACKGRPUND_IMAGE_MARK_PATH");d.freeGiftMap[u.type]=u;d.giftMap[u.type]=u;if(d.isNotExistInArray(d.freeGifIds,u.type)){d.freeGifIds.push(u.type)}});var q=h.find("prepaid");var j=q.children("item");$.each(j,function(t,v){var u={};v=$(v);u.isPaid=false;u.type=v.attr("PAID_PROPS_TYPE");u.name=v.attr("PAID_PROPS_NAME");u.price=v.attr("DWB_PROPS_PRICE");u.grade=v.attr("PAID_PROPS_GRADE");u.desc=v.attr("PAID_PROPS_DESCRIPTION");u.iconUrl=v.attr("PROPS_MOBILE_ICON_PATH");if(u.iconUrl==null){u.iconUrl=v.attr("PROPS_MOBILE_ICON_PATH")}u.gif=v.attr("PAID_PROPS_GIF_PATH2");if(u.gif==null){u.gif=v.attr("PAID_PROPS_MAX_ICON_PATH")}u.imageUrl=v.attr("PAID_PROPS_ICON_PATH2");u.smallUrl=v.attr("PAID_PROPS_MAX_ICON_PATH");u.cornerMark=v.attr("PAID_PROPS_CORNER_MARK_PATH");u.bgImg=v.attr("PAID_PROPS_BACKGRPUND_IMAGE_MARK_PATH");d.prepaidGiftMap[u.type]=u;d.giftMap[u.type]=u;if(d.isNotExistInArray(d.prepaidGifIds,u.type)){d.prepaidGifIds.push(u.type)}});var e=h.find("bigGift");var p=e.children("item");$.each(p,function(t,v){var u={};v=$(v);u.isPaid=true;u.type=v.attr("BIGGIFT_PROPS_TYPE");d.isBigGiftMap[u.type]=true});var k=h.find("WeekStarGift");var o=k.children("item");var g=new Date();$.each(o,function(w,y){y=$(y);var x=y.attr("start_time");var v=y.attr("end_time");var z=Date.parse(g)-Date.parse(x.replace(/-/g,"/"));var u=Date.parse(v.replace(/-/g,"/"))-Date.parse(g);if(z>=0&&u>0){var t=y.children("giftId");$.each(t,function(A,B){B=$(B);var C=B.attr("id");if(d.isNotExistInArray(b,C)){b.push(C)}})}});var s=h.find("paid");var n=s.children("item");$.each(n,function(t,v){var u={};v=$(v);u.isPaid=true;u.type=v.attr("PAID_PROPS_TYPE");u.name=v.attr("PAID_PROPS_NAME");u.price=v.attr("DWB_PROPS_PRICE");u.grade=v.attr("PAID_PROPS_GRADE");u.desc=v.attr("PAID_PROPS_DESCRIPTION");u.iconUrl=v.attr("PAID_PROPS_MAX_ICON_PATH");u.imageUrl=v.attr("PAID_PROPS_GIF_PATH");u.imgPath=v.attr("PAID_PROPS_GIF_PATH");u.smallUrl=v.attr("PAID_PROPS_ICON_PATH");u.paidPlatform=v.attr("PAID_PROPS_PLATFORM");u.cornerMark=v.attr("PAID_PROPS_CORNER_MARK_PATH");u.bgImg=v.attr("PAID_PROPS_BACKGRPUND_IMAGE_MARK_PATH");u.gif=v.attr("PAID_PROPS_GIF_PATH2");if(u.gif==null){u.gif=v.attr("PAID_PROPS_MAX_ICON_PATH")}if(u.paidPlatform==0){d.giftMap[u.type]=u;d.paidGiftMap[u.type]=u;if(d.isNotExistInArray(d.paidGiftIds,u.type)){d.paidGiftIds.push(u.type)}if($.inArray(u.type,b)<0){}else{c.push(u.type)}}});var r=h.find("giftReqUrl");var l=r[0];if(l){d.giftReqUrl=l.textContent}$.each(o,function(w,y){y=$(y);var x=y.attr("start_time");var v=y.attr("end_time");var z=Date.parse(g)-Date.parse(x.replace(/-/g,"/"));var u=Date.parse(v.replace(/-/g,"/"))-Date.parse(g);if(z>=0&&u>0){var t=y.children("giftId");$.each(t,function(A,B){B=$(B);var C=B.attr("id");d.weekStarGiftMap[C]=d.giftMap[C]})}});var i=h.find("packageGift");if(i){var n=i.children("item");$.each(n,function(v,w){w=$(w);var y=w.attr("id");if(y=="prepaid"){var u=w.attr("content");var t=u.split(",");if(t&&t.length>0){for(var v=0;v<t.length;v++){var x=t[v];if(d.isNotExistInArray(d.prepaidCfgGifs,x)){d.prepaidCfgGifs.push(x)}}}}})}d.renderAndBindingEven()},error:function(e,g,f){console.log(e.status);console.log(e.readyState);console.log(g)}})},isNotExistInArray:function(a,b){if($.inArray(b,a)<0){return true}return false},renderAndBindingEven:function(){var a=Gift;a.renderPaidGift();a.renderPackagetGift();a.rectifyGiftPosition();a.bindEvent();a.addGrayscale()},renderPaidGift:function(){var e=Gift;var d="";var b="";$("#paid-gifts-wrap").empty();$("#paid-tips-list").empty();for(var c=0;c<e.paidGiftIds.length;c++){var a=e.paidGiftIds[c];var h=e.paidGiftMap[a];var g=e.paidType;var j="";if(h.bgImg){j='style="background:url('+h.bgImg+') 1px 1px no-repeat"'}var f="";var k="";if(e.weekStarGiftMap[a]){g=e.weekStarType;k=staticPath+"/images/show/room/gift-icon-weekstar.png?v=781acda2"}else{if(h.cornerMark){k=h.cornerMark}}if(k){f='<img src="'+k+'">'}d+="<li id="+a+" value="+g+" "+j+"><a href='javascript:void(0);'><img id='giftImg' src='"+h.iconUrl+"'><div class='superscript'>"+f+"</div></a></li>";b+='<div class="tips"></div>'}$("#paid-gifts-wrap").html(d);$("#paid-tips-list").html(b)},renderPackagetGift:function(){var e=Gift;var d="";var b="";$("#package-gifts-wrap").empty();$("#package-gift-tips").empty();for(var c=0;c<e.prepaidCfgGifs.length;c++){var a=e.prepaidCfgGifs[c];var g=e.prepaidGiftMap[a];if(g){var h="";if(g.bgImg){h='style="background:url('+g.bgImg+') 1px 1px no-repeat"'}var f="";var j="";if(e.weekStarGiftMap[a]){type=e.weekStarType;j=staticPath+"/images/show/room/gift-icon-weekstar.png?v=781acda2"}else{if(g.cornerMark){j=g.cornerMark}}if(j){f='<img src="'+j+'">'}d+="<li class='disabled' id="+a+" value="+e.preType+" "+h+"><a href='javascript:void(0);'><img id='giftImg' src='"+g.iconUrl+"'><div class='superscript'>"+f+"</div>";d+="<div class='amount hide'><span class='num' id=packgeAmount_"+a+">0</span><span class='bg-l'></span><span class='bg-r'></span></div>";d+="</a></li>";b+='<div class="tips"></div>'}}$("#package-gifts-wrap").html(d);$("#package-gift-tips").html(b);e.loopGetUserFreePack()},renderFreeGift:function(g){var d=Gift;var c=d.freeGiftMap[g];var b="";var f="";if(c){var a="";var e="";if(d.weekStarGiftMap[g]){type=d.weekStarType}b+="<li class='disabled' id="+g+" value="+d.freeType+" style='display: none;'><a href='javascript:void(0);'><img id='giftImg' src='"+c.iconUrl+"'>";b+="<div class='amount hide'><span class='num' id=packgeAmount_"+g+">0</span><span class='bg-l'></span><span class='bg-r'></span></div>";b+="</a></li>";f+='<div class="tips"></div>'}$("#package-gifts-wrap").append(b);$("#package-gift-tips").append(f)},loopGetUserFreePack:function(){var b=Gift;var c=0;var a=setInterval(function(){if((b.isGiftModuleReady&&EntAppReady.isReady())||c++>=100){clearInterval(a);b.getUserFreePack();console.log("包裹 调用 getUserFreePack() loopGetUserFreePack..."+b.isGiftModuleReady+"|"+EntAppReady.isReady())}},100)},onGiftModuleReady:function(){var a=Gift;a.isGiftModuleReady=!EntAppHandler.sendToFlash("isGuestLogin");console.log("包裹 flash onGiftModuleReady。。。。。")},callJsAddGiftTips:function(d){var c=Gift;if(d){for(var b=0;b<d.length;b++){var a=d[b];c.package_week_winnerMap[a.id]=a}}},gift_list_broadcast_cb:function(a){var b=Gift;if(!a){return}if(a.broadcast=="0"){console.log("gift url flash0回调broadcast=0|url:"+a.url)}else{if(a.broadcast=="1"){console.log("gift url flash1回调broadcast=1|url:"+a.url)}}if(b.giftReqUrl!=a.url){console.log("gift url flash回调与本地不同重新发请求渲染");setTimeout(function(){b.initGift(a.url)},parseInt(Math.random()*3000))}},consume_rankLast_week_winner_rsp:function(c){var d=Gift;if(c&&c.mlist){var e=c.mlist;for(var b=0;b<e.length;b++){var a=e[b];d.week_winnerMap[a.type]=a}}console.log("包裹 flash consume_rankLast_week_winner_rsp。。。。。")},addPrepaidGift:function(h){var e=Gift;var b=false;var f=e.currentSelectGift.type;for(var c=0;c<h.length;c++){var d=h[c];var a=d.giftId;var j=d.addCount*1;if(f==a){b=true}if(e.prepaidGiftMap[a]){var g=e.prepaidGiftMap[a].count*1;if(!g||g<0){g=0}g+=parseInt(j);e.prepaidGiftMap[a].count=g;if(g>0){e.lightUpPackGift(a,e.prepaidGiftMap[a].iconUrl,g)}}}if(b){e.calPackageMax()}},free_present_list_cb:function(i,b){var d=Gift;var g=i.packageObj;for(var h in g){var c=g[h];console.log("查询免费礼物回调--------------------------------礼物id="+h+"---count="+c+"--=============--------------------=============");var a=null;if(d.freeGiftMap[h]!=null){d.freeGiftMap[h].count=c;a=d.freeGiftMap[h];if(d.isNotExistInArray(d.userFreeGift,h)){d.renderFreeGift(h);d.userFreeGift.push(h)}}else{if(d.prepaidGiftMap[h]!=null){d.prepaidGiftMap[h].count=c;a=d.prepaidGiftMap[h];if(d.isNotExistInArray(d.userPrepaidGift,h)){d.userPrepaidGift.push(h)}}}if(Gift.giftMap[h]!=null){Gift.giftMap[h].count=c}if(!a){continue}try{d.lightUpPackGift(h,a.iconUrl,c)}catch(f){console.log("询免费礼物回调 报错e="+f+"|id="+h)}}d.bindGiftList();d.addGrayscale()},lightUpPackGift:function(h,f,e){var d=Gift;var c="#package-gifts-wrap li#"+h;$(c).removeClass("disabled");$(c).show();var b="#package-gifts-wrap li#"+h+" a img";$(b).removeClass("grayscale");b="#package-gifts-wrap li#"+h+" a image";if(b){$(b).css("filter","none")}b="#package-gifts-wrap li#"+h+" a";var g=$(b).children(":first");var a=g.is("div");if(a){b="#package-gifts-wrap li#"+h+" a div.grayscale";if(b){$(b).remove();b="#package-gifts-wrap li#"+h+" a";$(b).prepend("<img id='giftImg' src='"+f+"'>")}}if(e>0){if(e>10000000){e="9999999+"}$("#packgeAmount_"+h).html(e);$("#packgeAmount_"+h).parent().removeClass("hide")}},getUserFreePack:function(){var a=Gift;if(!LoginUtil.isLogin()){a.isFinishRreeGift=true;return}if(!liveplayer.pageInfo){a.popMessage("正在初始化,请稍后...");return}Gift.userObject.topSid=liveplayer.pageInfo.sid;Gift.userObject.subSid=liveplayer.pageInfo.ssid;Gift.userObject.yyuid=UserContext.uid;EntAppHandler.call(Events.ENTPUB.FREE_PACKAGE_LIST_REQ,Gift.userObject)},isOpeningWhat:function(c,a){var b=Gift;var d=c.context.id;if(!a){b.opening=0;return}if("more-paid-gifts"==d){b.opening=1}else{if("more-package-gifts"==d){b.opening=2}}if(a){liveplayer.showMask()}else{liveplayer.hideMask()}},bindGiftList:function(){var j=Gift;var d=$(".ent-content>.toolbar .gift-list");var f=d.find(".gifts.active");if(j.giftHeight==0){j.giftHeight=f.find("li").outerHeight(true)}var g=null;var c=6;d.find(".gifts-wrap").each(function(){var o=$(this).find("li").not(".disabled"),m=0,n=c-o.length%c;$(this).data("height",(j.giftHeight-6)*Math.ceil(o.length/c));if(j.isPaidTab){if(o.length<=c){$(this).next(".arrow").addClass("disabled")}for(;m<n&&n<c;m++){$(this).children("ul").append('<li class="disabled"></li>')}}});var b=false;d.find(".arrow").unbind("click").bind("click",html5Test.transition?function(){var r=$(this).parent(),o=r.children().eq(0),q=o.find("li").not(".disabled").length;var n=this.id;if(q<=c){return}if(r.hasClass("extend")){b=false;r.removeClass("extend");var m=0;if(n=="more-paid-gifts"){m=j.giftTabIndex}else{m=j.packageTabIndex}var p=-Math.floor(m/6)*j.giftHeight-4;if(n=="more-paid-gifts"){$("#paid-gifts-wrap").css("top",p+"px")}else{$("#package-gifts-wrap").css("top",(p-2)+"px")}o.removeAttr("style")}else{b=true;r.addClass("extend");if(n=="more-paid-gifts"){o.css("height",o.data("height")+"px");$("#paid-gifts-wrap").removeAttr("style")}else{o.css("height",(j.giftHeight-6)*Math.ceil(q/c));$("#package-gifts-wrap").removeAttr("style")}}j.isOpeningWhat(r,b);return false}:function(){var p=$(this).parent(),n=p.children().eq(0),o=n.find("li").length;var m=this.id;if(o<=c){return}if(p.hasClass("extend")){b=false;n.stop().animate({height:j.giftHeight+"px"},200,null,function(){p.removeClass("extend");var q=0;if(m=="more-paid-gifts"){q=j.giftTabIndex}else{q=j.packageTabIndex}var r=-Math.floor(q/6)*j.giftHeight-4;if(m=="more-paid-gifts"){$("#paid-gifts-wrap").css("top",r+"px")}else{$("#package-gifts-wrap").css("top",(r-2)+"px")}n.removeAttr("style")})}else{b=true;p.addClass("extend");n.stop().css("height",j.giftHeight+"px").animate({height:n.data("height")+"px"},200);if(m=="more-paid-gifts"){$("#paid-gifts-wrap").removeAttr("style")}else{$("#package-gifts-wrap").removeAttr("style")}}j.isOpeningWhat(p,b);return false});var i=0;var e=0;var k=null;var l=null;d.find("li").hover(function(){var p=$(this);var r=p.context.id;var q=p.context.value;l=j.getGiftByIdAndType(r,q);k=p.find("img#giftImg")[0];if(k){k.src=l.gif}var n=p.index(),o=null;g=f.find(".tips").eq(n);j.tipsTarget=g;j.setTips(g,r,q);if(g){o=f.children(".gifts-wrap");if(b){g.css({left:(p[0].offsetLeft-(34-54/2)+8)+"px",bottom:(o[0].offsetHeight-Math.floor(n/6)*(j.giftHeight-6)-9)+"px"}).addClass("show")}else{g.css({left:(p[0].offsetLeft-(34-54/2)+8)+"px",bottom:(o[0].offsetHeight-9)+"px"}).addClass("show")}if(!html5Test.animation){g.stop().css("opacity","0").animate({opacity:"1"},200)}}if(!html5Test.transform){var m=g.find("img");!m.attr("style")&&m.css("margin-top",-m.height()/2+"px")}},function(){g&&g.removeClass("show");if(k){k.src=l.iconUrl}}).unbind("click").bind("click",function(p){d.find("li").removeClass("active");var o=null;if(j.isPaidTab){o=$("#paid-gifts-wrap")}else{o=$("#package-gifts-wrap")}var q=$(this).context.id;if(!q){p.stopPropagation();return}var n=j.prepaidGiftMap[q];if(j.isDisable($(this))&&!n){p.stopPropagation();return}if(!j.isDisable($(this))){j.selectGift($(this));var m=o.find("li").index($(this));if($.inArray(q,j.paidGiftIds)>=0){if(m>=0){j.giftTabIndex=m;j.packageTabIndex=0}}else{if(m>=0){j.giftTabIndex=0;j.packageTabIndex=m}}if(j.isPaidTab){j.resizeFirstRow(false)}else{j.resizeFirstRow(true)}}if(j.isChromeBrowser()){e++;if(new Date().getTime()-i<400&&e>=2){e=0;if(!j.isDisable($(this))){j.sendGift()}else{j.popTurntable()}}i=new Date().getTime()}p.stopPropagation()}).unbind("dblclick").bind("dblclick",function(n){if(!j.isChromeBrowser()){var o=$(this).context.id;if(!o){n.stopPropagation();return}var m=j.prepaidGiftMap[o];if(j.isDisable($(this))&&!m){n.stopPropagation();return}if(!j.isDisable($(this))){j.sendGift()}else{j.popTurntable()}}n.stopPropagation()});var a=d.find(".tabs a");a.unbind("click").bind("click",function(){var m=0,p=c,n,o=0;if(this.id=="paidGifts"){j.isPaidTab=true;m=Math.floor(j.giftTabIndex/6)*c}else{j.getUserFreePack();j.isPaidTab=false;m=Math.floor(j.packageTabIndex/6)*c}p+=m;if($(this).hasClass("active")){return false}f.removeClass("active extend").children(".gifts-wrap").removeAttr("style");if($(this).index()===0){f=f.prev()}else{f=f.next()}n=f.find("li");for(;m<p;m++){n.eq(m).addClass("is-transparent");if(!html5Test.transition){n.eq(m).stop().css("opacity","0")}}f.addClass("active");for(m=p-c;m<p;m++){(function(q,r){window.setTimeout(function(){q.removeClass("is-transparent");if(!html5Test.transition){q.stop().animate({opacity:"1"})}},r*100)})(n.eq(m),o++)}a.removeClass("active");$(this).addClass("active");j.rectifyGiftPosition();j.addGrayscale();return false});if(!html5Test.transition){var h=a.parent().children(".active-icon");h.css("top","0");a.hover(function(){if($(this).hasClass("active")){return}h.stop().animate({top:$(this)[0].offsetTop+"px"},200)},function(){if($(this).hasClass("active")){return}h.stop().animate({top:a.filter(".active")[0].offsetTop+"px"},200)})}j.$giftSubmit=$(".ent-content>.toolbar .gift-submit");j.$giftSubmit.find(".arrow").unbind("click").bind("click",html5Test.transition?function(){if(j.$giftSubmit.hasClass("extend")){j.$giftSubmit.removeClass("extend")}else{j.$giftSubmit.addClass("extend")}return false}:function(){var m=j.$giftSubmit.find(".option-list");if(j.$giftSubmit.hasClass("extend")){m.stop().animate({height:"0"},200,null,function(){j.$giftSubmit.removeClass("extend")})}else{j.$giftSubmit.addClass("extend");m.stop().css("height","0").animate({height:"252px"},200)}return false})},resizeFirstRow:function(d){var c=Gift;var a=0;if(d){a=c.giftTabIndex}else{a=c.packageTabIndex}var b=-Math.floor(a/6)*c.giftHeight-4;if(d){$("#paid-gifts-wrap").css("top",b+"px")}else{$("#package-gifts-wrap").css("top",(b-2)+"px")}},addGrayscale:function(){var a=Gift;if(a.isPaidTab){return}$("#package-gifts-wrap li").each(function(){var d=$(this).context.id;var b=a.prepaidGiftMap[d];if(b&&(!b.count||b.count<=0)){var c="#package-gifts-wrap li#"+d+" a img";$(c).addClass("grayscale")}});$(".grayscale").gray()},rectifyGiftPosition:function(){var a=Gift;if(a.isOldIE()){if(a.isPaidTab){$("#paid-gifts-wrap li").each(function(){var b=$(this).find("a>img");var c=($(this).innerHeight()-b.height())/2;b.css("margin-top",c+"px")})}else{$("#package-gifts-wrap li").each(function(){var b=$(this).find("a>img");var c=($(this).innerHeight()-b.height())/2;b.css("margin-top",c+"px")})}}},popTurntable:function(){var b=Gift;var a=LoginUtil.isLogin();if(a){if(Turntable.hadTurntable){Turntable.showTurntable()}}else{LoginUtil.showLoginOrRegister()}},isDisable:function(c){var b=c.find("a img").hasClass("grayscale");if(b){return b}var a=c.find("a").children(":first").hasClass("grayscale");if(c.find("a")){return c.find("a").children(":first").hasClass("grayscale")}},isOldIE:function(){if(navigator.appName=="Microsoft Internet Explorer"&&navigator.appVersion.split(";")[1].replace(/[ ]/g,"").indexOf("MSIE7.")>=0){return true}return false},isChromeBrowser:function(){var a=Gift;if(a.isChrome==null){a.isChrome=(window.navigator.userAgent.indexOf("Chrome")!==-1)}return a.isChrome},sendAnimation:(function(a,b){var c={totalTime:200,frameId:0,startTime:0,lastTime:0,hitCount:0,intervalTime:16,playing:false,currentFrame:0,totalFrames:31,bgImgWidth:130,leftTimeFrames:0,leftTimeBgImgWidth:93,animateInterval:90,animateLastTime:0,$comboAnimationEl:$("#combo_hit_animation"),$leftTimeEl:$("#combo_hit_left_time"),$effectFrames:$(".ent-content>.toolbar .gift-submit .effect-frames"),lastGiftId:-1,lastSendCount:-1,hit:function(g,m){window.cancelAnimationFrame(this.frameId);this.startTime=this.lastTime=new Date().getTime();this.playing=true;this.$comboAnimationEl.parent().addClass("playing");this.$leftTimeEl.text("");if(this.lastGiftId!=g||this.lastSendCount!=m){this.hitCount=0}this.lastGiftId=g;this.lastSendCount=m;if(this.hitCount++){var e=""+this.hitCount,j=0,d=e.length,f=document.createElement("div"),k='<div class="combo-hit-count"><span class="icon plus"></span>';f.className="combo-hit-count";f.style.zIndex=this.hitCount;for(;j<d;j++){k+='<span class="icon n'+e.substr(j,1)+'"></span>'}f.innerHTML=k;this.$comboAnimationEl[0].appendChild(f);window.setTimeout(function(){if(html5Test.transition){f.className="combo-hit-count disappear"}else{$(f).stop().css("bottom","20px").animate({bottom:"40px",opacity:"0"},2000)}},17);if(html5Test.animation){this.$leftTimeEl.css("animation","none");window.getComputedStyle(this.$leftTimeEl[0]).animation;window.getComputedStyle(this.$leftTimeEl[0])[cssPrefix+"Amimation"];this.$leftTimeEl.css("animation","")}}if(!html5Test.animation){this.leftTimeFrames=0}var l=this;this.frameId=window.requestAnimationFrame(function h(){var i=new Date().getTime();if((i-l.lastTime)>=l.intervalTime){var n=l.totalTime-Math.floor((i-l.startTime)/l.intervalTime)+1;if(n<=0){l.reset();return}l.lastTime=i}if(!html5Test.animation&&(i-l.animateLastTime)>l.animateInterval){l.currentFrame=(++l.currentFrame)%l.totalFrames;l.$effectFrames[0].style.backgroundPosition="-"+l.currentFrame*l.bgImgWidth+"px 0";l.$leftTimeEl[0].style.backgroundPosition="-"+(l.leftTimeFrames++)*l.leftTimeBgImgWidth+"px 0";l.animateLastTime=i}l.frameId=window.requestAnimationFrame(h)})},reset:function(){window.cancelAnimationFrame(this.frameId);this.hitCount=0;this.playing=false;this.$comboAnimationEl.parent().removeClass("playing");var d=this.$comboAnimationEl[0].lastChild;do{if(-1<d.className.indexOf("combo-hit-count")){this.$comboAnimationEl[0].removeChild(d);d=this.$comboAnimationEl[0].lastChild}else{d=this.previousSibling}}while(d)}};return function(d,e){c.hit(d,e)}})(),selectGift:function(c){var b=Gift;var a=c.context.id;var d=c.context.value;if(!a){return}b.currentSelectGift=b.getGiftByIdAndType(a,d);b.currentSelectGift.giftType=d;$("#gift-select-img-id").find("img")[0].src=b.currentSelectGift.iconUrl;c.addClass("active");if(b.currentSelectGift.isPaid){if(b.isBigGiftMap[a]){b.max=1}else{b.max=b.getGradeMaxCount(b.currentSelectGift.grade)}b.limitMaxInput()}else{b.calPackageMax()}},limitMaxInput:function(){var a=Gift;var b=a.giftInputNum.val();if(a.max<parseInt(b)){a.giftInputNum.val(a.max)}a.changeNumBar(a.currentSelectGift)},calPackageMax:function(){var a=Gift;a.max=parseInt(a.currentSelectGift.count);if(a.max>a.packageGiftMax){a.max=a.packageGiftMax}a.limitMaxInput()},changeNumBar:function(a){var f=Gift;var e="";var b=a.grade;f.moreNumSize=0;if(!a.isPaid){b=f.getGradeByCount(f.max)}if(f.isBigGiftMap[a.type]){e+="<li><span>1</span></li>";f.moreNumSize++}else{for(var d=9;d>=b;d--){if(b<=3&&d<3){break}var c=f.getGradeMaxCount(d);var g=f.getNumDesc(c);e+="<li><span>"+c+"</span>"+(g?("("+g+")"):"")+"</li>";f.moreNumSize++}}f.numSelect.children("ul").html(e);if(f.isShowSelect()){f.numSelect.css("height",36*f.moreNumSize+"px")}f.bindInputArea()},isShowSelect:function(){var a=Gift;return a.numExtend.hasClass("extend")},bindInputArea:function(){var b=Gift;var a=b.$giftSubmit.find(".option-list li");a.unbind("click").bind("click",function(d){a.filter(".active").removeClass("active");$(this).addClass("active");var c=parseInt($(this).children("span").text());if(c>parseInt(b.max)){c=b.max}b.giftInputNum.val(parseInt(c))});b.moreNumSelect.unbind("click").bind("click",function(c){b.numExtend.toggleClass("extend");if(b.isShowSelect()){liveplayer.showMask();b.numSelect.css("height",36*b.moreNumSize+"px")}else{liveplayer.hideMask();b.numSelect.css("height","0px")}c.stopPropagation()});b.giftInputNum.keydown(function(i){var j=b.giftInputNum;var g=i.keyCode;var f=j.get(0);var n=f.selectionStart;var h=f.selectionEnd;var l=j.val();if(((g>=48)&&(g<=57))){if(n==0&&g==48){b.preventMyEvent(i)}else{var m=l.substring(0,n);var d=l.substring(h);var c=Number(m+(g-48)+d);if(c>b.max){j.val(b.max);b.preventMyEvent(i)}else{if(c<1){j.val(1);b.preventMyEvent(i)}}}}else{if((g>=96)&&(g<=105)){if(n==0&&g==96){b.preventMyEvent(i)}else{var m=l.substring(0,n);var d=l.substring(h);var c=Number(m+(g-96)+d);if(c>b.max){j.val(b.max);b.preventMyEvent(i)}else{if(c<1){j.val(1);b.preventMyEvent(i)}}}}else{if(g==8||g==46||g==0||(g>=37&&g<=40)){}else{b.preventMyEvent(i)}}}});b.giftInputNum.blur(function(){var c=b.giftInputNum.val();if(c<=0){input.val(1)}})},sendGift:function(){Gift.handleSendGift()},handleSendGift:function(){var d=Gift;if(!d.currentSelectGift){d.popMessage("请先选择一个礼物");return}var c=d.giftInputNum.val();var a=d.currentSelectGift.type;if(!LoginUtil.isLogin()){LoginUtil.showLoginOrRegister();return}if(c<=0){d.popMessage("请输入正确的礼物数量");return}if(EntAppReady.isReady()){var b=-1;if(d.currentSelectGift.isPaid){b=EntAppHandler.call("call_buy_present",{type:a,num:c,fCode:80002,PBUY_KEY_PRODUCTINFO:header.ref+"_"+header.pcuid})}else{b=EntAppHandler.call(Events.ENTPUB.BUY_PRESENT_FREE_REQ,{type:a,num:c,propClass:4,fCode:80002})}d.sendCommandResult(b)}else{d.sendCommandResult("isSuccessSend")}},sendCommandResult:function(a){var b=Gift;switch(a){case 0:return;case 1:b.popMessage("参数错误");return;case 2:b.popMessage("麦序为空");return;case 3:LoginUtil.showLoginOrRegister();return;case 4:b.popMessage("用户信息有误，请重新登陆");return;case 5:b.popMessage("获取首麦失败");return;case 6:b.popMessage("不能发送给自己");return;case 10:return;default:b.popMessage("正在初始化,请稍后...");break}},buyPresentResult:function(c){var b=Gift;var a=c.result;switch(a){case 0:b.sendAnimation(c.type,c.num);b.sendMonitorData(c);if(window.combineFlag){if(typeof Header!="undefined"){Header.sendGiftCallbackRefresh(0,c.num,c.type)}}header.headerUserInfoRefresh=true;break;case 1:Recharge.showQrBox();break;case 2:b.popMessage("抱歉，不能自己送给自己哦！");break;case 3:b.popMessage("您要赠送的 "+c.toName+"已经离开1号麦序，您不能进行本次赠送了哦！");break;case 4:b.popMessage("对不起，月票只能送给签约歌手哦~，选择其他礼物赠送吧！");break;case 6:b.popMessage("抱歉，礼物已经下架，请选择别的礼物吧！");break;case 7:b.popMessage("退出频道升级");break;case 10:b.popMessage("操作太频繁，请稍后再试!");break;case 103017:b.popMessage("对不起，娱乐套件4.0删档内测期间，只有受邀用户才能使用该功能哦。");break;case 103023:b.popMessage("已开启消费锁,解锁后才能消费");break;case 102323:b.popMessage("已开启消费锁,无法消费");break;case 103021:b.popMessage("参数错误");break;case 103020:b.popMessage("sql affected row错误");break;case 103022:b.popMessage("K币消费失败");break;case 103024:b.popMessage("获取用户的消费状态失败");break;case 103019:b.popMessage("查询日期超出有效范围");break;case 103025:b.popMessage("消费商品类型不被允许");break;case 103026:b.popMessage("处于月结不允许做此操作");break;default:b.popMessage("未知错误码： "+a);break}if(a!=0){}},payComfirm:function(a){a.choice=a.userChoice;EntAppHandler.call(EntFns.ENTPUB.BUY_PRESENT_CONFIRM,a)},buyPresentComfirm:function(b){var a=Gift;if(b.popDwbWin){if(!window.dwbCustomCallback){window.dwbCustomCallback=function(d){a.enableSend();if(a.isComboRunning()){a.comboEffectReStart()}}}showDwbDlg(b)}else{a.payConfirmModule.show();a.payData=b;var c=b.notifyText;a.payContext.html(c)}},free_present_send_result_cb:function(a,g){var f=Gift;var k=a.result;switch(k){case 0:var b=a.type;var h=f.freeType;var i=f.prepaidGiftMap[b];if(i){f.sendAnimation(b,a.num);h=f.preType}else{i=f.freeGiftMap[b]}if(i==null||i==undefined||i=="undefined"){return}i.count=i.count-a.num;if(i.count<=0||isNaN(i.count)){var j="#package-gifts-wrap li#"+b;if(h==f.preType){$(j).addClass("disabled");var d="#package-gifts-wrap li#"+b+" a img";$(d).addClass("grayscale");var c="#package-gifts-wrap li#"+b+" a img#giftImg";$(c).src=i.iconUrl;$(d).gray();$("#packgeAmount_"+b).parent().addClass("hide")}else{$(j).hide()}}else{f.setTips(f.tipsTarget,b,h);var e=i.count;if(e>10000000){e="9999990+"}$("#packgeAmount_"+b).html(e)}break;case 1:f.popMessage("抱歉，您赠送的包裹礼物不足!");break;case 2:f.popMessage("抱歉，不能自己送给自己哦！");break;case 3:f.popMessage("您要赠送的 "+a.toName+"已经离开1号麦序，您不能进行本次赠送了哦！");break;case 4:f.popMessage("对不起，月票只能送给签约歌手哦~，选择其他礼物赠送吧！");break;case 5:f.popMessage("送礼物失败！");break;case 6:f.popMessage("抱歉，礼物已经下架，请选择别的礼物吧！");break;case 9:f.popMessage("该礼物只能由客户端送出！");break;case 10:f.popMessage("送礼物需要在频道呆够时间才能送！");break;case 7:f.popMessage("退出频道升级！");break;case 103017:f.popMessage("对不起，娱乐套件4.0删档内测期间，只有受邀用户才能使用该功能哦。");break;case 103023:f.popMessage("已开启消费锁,解锁后才能消费");break;case 102323:f.popMessage("已开启消费锁,无法消费");break;case 103021:f.popMessage("参数错误");break;case 103020:f.popMessage("sql affected row错误");break;case 103022:f.popMessage("K币消费失败");break;case 103024:f.popMessage("获取用户的消费状态失败");break;case 103019:f.popMessage("查询日期超出有效范围");break;case 103025:f.popMessage("消费商品类型不被允许");break;case 103026:f.popMessage("处于月结不允许做此操作");break;default:f.popMessage("未知错误码："+k);break}},sendMonitorData:function(c){if(liveplayer.monitorType.length>0){var b={};b.clientType="web";var d={};d.userId=c.fromId;d.anchor_id=c.toId;d.sid=liveplayer.pageInfo.sid;d.ssid=liveplayer.pageInfo.ssid;d.gift_id=c.type;d.gift_cnt=c.num;b.data=d;b.monitorTypes=liveplayer.monitorType;var a=JSON.stringify(b);window.mon.sendGiftMonitor(a)}},getMaxGiftNum:function(b){var a=Gift.giftInputNum.val();if(a<=Gift.getGradeMaxCount(b)){return a}else{return Gift.getGradeMaxCount(b)}},getGiftEffectsLevel:function(c,d){var b=0,a=Gift.numLevel;if(d<a[3]){b=3;if(d<a[1]){b=1;if(d<a[0]){b=0}}else{if(d<a[2]){b=2}}}else{if(d<a[4]){b=4}else{if(d<a[5]){b=5}else{b=6}}}if(b==0){return 0}if((c+b-3)>6){return 6}return c+b-3},getGiftInitLevelCount:function(c){var b=0;for(var a=1;a<=6;a++){if(c+a-3>0){b=a;break}}if(b==1){return 10}else{if(b==2){return 30}else{if(b==3){return 66}else{if(b==4){return 188}else{if(b==5){return 520}else{if(b==6){return 1314}}}}}}},preventMyEvent:function(a){if(window.event){window.event.returnValue=false}else{a.preventDefault()}},getNumDesc:function(a){if(window.combineFlag){return{1:"一心一意",10:"十全十美",30:"想你",66:"一切顺利",188:"要抱抱",520:"我爱你",1314:"一生一世"}[a]}return{1:null,10:"十全十美",30:"想你",66:"一切顺利",188:"要抱抱",520:"我爱你",1314:"一生一世"}[a]},getGradeMaxCount:function(a){if(a==1||a==2||a==3){return 1314}if(a==4){return 520}if(a==5){return 188}if(a==6){return 66}if(a==7){return 30}if(a==8){return 10}return 1},getGradeByCount:function(a){if(a>520){return 3}if(a>188){return 4}if(a>66){return 5}if(a>30){return 6}if(a>10){return 7}if(a>1){return 8}return 9},getGiftByIdAndType:function(d,a){var c=Gift;var b=null;if(a==c.preType){b=c.prepaidGiftMap[d]}else{if(a==c.freeType){b=c.freeGiftMap[d]}else{if(a==c.weekStarType){b=c.weekStarGiftMap[d]}else{if(a==c.paidType){b=c.paidGiftMap[d]}}}}return b},popMessage:function(a){new ShowDialog.POPUP({width:200,content:a,timeout:true})},broadCastGift:function(a){EntAppHandler.sendToFlash("sendGiftCB",a)},addEntListeners:function(){EntAppHandler.addEventListener("onGiftModuleReady",Gift.onGiftModuleReady);EntAppHandler.addEventListener("callJsAddGiftTips",Gift.callJsAddGiftTips);EntAppHandler.addEventListener("gift_list_broadcast_cb",Gift.gift_list_broadcast_cb);EntAppHandler.addEventListener(Events.ENTPUB.FREE_PACKAGE_LIST_RESP,Gift.free_present_list_cb);EntAppHandler.addEventListener(Events.ENTPUB.BUY_PRESENT_FREE_RESP,Gift.free_present_send_result_cb);EntAppHandler.addEventListener(Events.ENTPUB.BUY_PRESENT_RESULT,Gift.buyPresentResult);EntAppHandler.addEventListener(Events.ENTPUB.BUY_PRESENT_CONFIRM,Gift.buyPresentComfirm);EntAppHandler.addEventListener(Events.ENTPUB.RECEIVE_PRESENT,Gift.broadCastGift);EntAppHandler.addEventListener("consume_rankLast_week_winner_rsp",Gift.consume_rankLast_week_winner_rsp)},setTips:function(c,b,i){var f=Gift;var m=f.getGiftByIdAndType(b,i);if(m==null){return}var g=f.getGiftEffectsLevel(parseInt(m.grade),parseInt(f.giftInputNum.val()));var l=f.getGiftInitLevelCount(parseInt(m.grade));var j=10;var k=1;if(Number(g)>0){j=f.getMaxGiftNum(m.grade);k=g}else{j=l;k=f.getGiftEffectsLevel(parseInt(m.grade),parseInt(j))}var d="";var h=f.week_winnerMap[b];if(m.isPaid){if(i==f.weekStarType){d+='<div class="tips-content"><div class="intro"><div class="left"><img src="'+m.gif+'"></div>';d+='<div class="right"><div class="title">'+m.name+'<span class="price">('+(m.price/100)+"Y币/"+(m.price*10)+"红钻)</span></div>";d+='<div class="desc">'+m.desc+"</div>";if(f.isBigGiftMap[b]){d+='<div class="combo">赠送可触发炫酷特效</div></div></div>'}else{d+='<div class="combo">一次赠送 <strong>'+j+"</strong> 个即可触发"+k+"星流光</div></div></div>"}d+='<div class="more week-star"><div class="left"><i class="icon"></i></div><div class="right">赠送可帮助主播竞争周星榜</div></div></div><div class="tips-bg"></div><div class="tips-bg bot"></div>'}else{d+='<div class="tips-content"><div class="intro"><div class="left">';d+='<img src="'+m.gif+'"></div><div class="right"><div class="title">'+m.name+'<span class="price">('+(m.price/100)+"Y币/"+(m.price*10)+"红钻)</span></div>";d+='<div class="desc">'+m.desc+"</div>";if(f.isBigGiftMap[b]){d+='<div class="combo">赠送可触发炫酷特效</div></div></div>'}else{d+='<div class="combo">一次赠送 <strong>'+j+"</strong> 个即可触发"+k+"星流光</div></div></div>"}if(h){d+='<div class="more brand"><div class="left"><i class="icon"></i></div><div class="right ellipsis">'+h.nick+"</div></div>"}d+='</div><div class="more"></div></div><div class="tips-bg"></div><div class="tips-bg bot"></div>'}}else{var a=f.package_week_winnerMap[b];var e=m.count;if(!e){e=0}d+='<div class="tips-content"><div class="intro"><div class="left">';d+='<img src="'+m.gif+'"></div><div class="right"><div class="title">'+m.name+'<span class="price">(数量:'+e+")</span></div>";d+='<div class="desc">'+m.desc+"</div>";if(i==f.preType){if(f.isBigGiftMap[b]){d+='<div class="combo">赠送可触发炫酷特效</div>'}else{if(e<=0){d+='<div class="combo">转盘专属，双击礼物图标前往获取</div>'}else{d+='<div class="combo">一次赠送 <strong>'+j+"</strong> 个即可触发"+k+"星流光</div>"}}}d+='</div></div><div class="more"></div>';if(a){d+='<div class="more brand"><div class="left"><i class="icon"></i></div><div class="right ellipsis">'+a.sponsor+"</div></div>"}d+='</div><div class="tips-bg"></div><div class="tips-bg bot"></div>'}c.html(d)},sendSpecialGift:function(c){var b=Gift;if(!LoginUtil.isLogin()){LoginUtil.showLoginOrRegister();return}if(EntAppReady.isReady()){var a=EntAppHandler.call("call_buy_present",c);b.sendCommandResult(a)}else{b.sendCommandResult("isSuccessSend")}}};PageContext={pageType:"room"};$(document).ready(function(){var a=1;LoginUtil.init();Gift.init();cherish.init();RoomRegistGuide.init();Recharge.init();BroadcasttHistory.init();LoginUtil.addLoginCallbacks(function(){EntAppHandler.sendToFlash("lampLogin")});LoginUtil.addLogoutCallbacks(function(){EntAppHandler.sendToFlash("lampLoginOut")});var b=new Date();var a=b.getMinutes();try{require(["http://act.m.yystatic.com/act/js/webAct/actTaskPublic.js"],function(d){});require(["http://earn.yystatic.com/earn/js/giftpk/actTaskPublic.js"],function(){})}catch(c){console.log(c)}});var addSheet=function(){var h,c;if(arguments.length==1){h=document;c=arguments[0]}else{if(arguments.length==2){h=arguments[0];c=arguments[1]}else{alert("addSheet函数最多接受两个参数!")}}if(!+"\v1"){var e=c.match(/opacity:(\d?\.\d+);/);if(e!=null){c=c.replace(e[0],"filter:alpha(opacity="+parseFloat(e[1])*100+")")}}c=c+"\n";var f=h.getElementsByTagName("head")[0];var b=f.getElementsByTagName("style");var d=h.createElement("style");d.setAttribute("type","text/css");d.setAttribute("id","appendStyle");f.appendChild(d);var a=b[0];var g=a.getAttribute("media");if(g!=null&&!/screen/.test(g.toLowerCase())){a.setAttribute("media","screen")}if(a.styleSheet){a.styleSheet.cssText+=c}else{if(h.getBoxObjectFor){a.innerHTML+=c}else{a.appendChild(h.createTextNode(c))}}};function hideActivityBanner(){addSheet("#activityBanner{display:none}")}function showActivityBanner(){$("#appendStyle").remove()}function yyActivityIsShow(a){console.log("isActOpen:"+a);if(a=="1"){TaskBar.hasEnoughPri=false;try{window.close_jgj_taskbar()}catch(b){}}else{TaskBar.hasEnoughPri=true}}function giftPKIsShow(a){console.log("isPkOpen:"+a);if(a=="1"){TaskBar.hasEnoughPri=false;if(window.CloseActivityInfoRsp){window.CloseActivityInfoRsp()}hideActivityBanner();try{window.close_jgj_taskbar()}catch(b){}}else{TaskBar.hasEnoughPri=true;if(window.OpenActivityInfoRsp){window.OpenActivityInfoRsp()}showActivityBanner()}};var cherish={tabContentDiv:"bangCntZat",tabContentDiv_MaxHeight:700,tabContentDiv_MinHeight:210,tabContentDiv_MyInfoHeight:85,tabContentDiv_myTitle_show:false,initDiv:false,dataMap:{},cherishGroupLevel:0,cherishGroupMaxLevel:7,cherishGroupName:"珍爱团",cherishGroupRank:"--",cherishGroupCups:"--",cherishGroupMedalPic:"",key_baseGroupInfo:"baseGroupInfo",key_myFansTitleInfo:"myFansTitleInfo",key_fansRankInfo:"fansRankInfo",type_channel_no_wheel:1,cherishFansRankResponse:true,init:function(){LoginUtil.addLogoutCallbacks(cherish.loginChangeCallBack4Cherish);LoginUtil.addLoginCallbacks(cherish.loginChangeCallBack4Cherish)},onFlashReady:function(){cherish.requestCherishFansRank();liveplayer.addMicListChangeCallback(cherish.micChange4Cherish);cherish.getRoomInfo()},micChange4Cherish:function(){if(!liveplayer.firstMic){cherish.hideCherishDiv();return}var a=Math.floor(Math.random()*500);console.log("micChange4Cherish--random time:"+a);if((window.PageContext.channelType!=cherish.type_channel_no_wheel)){window.setTimeout(function(){cherish.getRoomId()},a)}else{if(!window.PageContext.owuid){window.setTimeout(function(){cherish.getRoomInfo()},a)}if(window.PageContext.owuid!=liveplayer.firstMic){cherish.hideCherishDiv()}else{liveplayer.isCherishTabShow(true)}}},loginChangeCallBack4Cherish:function(){cherish.isCherishCanShow(cherish.renderCherishBaseGroupData);cherish.isCherishCanShow(cherish.renderMyFansTitleData)},hideCherishDiv:function(){liveplayer.isCherishTabShow(false);cherish.resetRenderCherishDiv();liveplayer.onAnchorCherishIcon("","");cherish.dataMap[cherish.key_baseGroupInfo]=[]},initRender:function(a){console.log("cherish  --  initRender "+a);cherish.initRenderCherishDiv(a)},resetRenderCherishDiv:function(){cherish.initDiv=false;cherish.initRenderCherishDiv(cherish.tabContentDiv)},initRenderCherishDiv:function(b){cherish.tabContentDiv=b;if(cherish.initDiv){return}console.log("cherish  --  initRenderCherishDiv "+b);var a="";a+='<div class="module-box billboard" id="cherish-module-box" style="height:inherit;">';a+='<div class="cherish-list level-0" id="cherish-list-div">';a+='<div class="head">';a+='<div class="img" id="cherish-group-pic-div"><img id="cherish-group-pic" src="http://res1.home.yystatic.com/images/show/room/cherish/snap.jpg"></div>';a+='<div class="info">';a+='<h5 class="title" id="cherish-group-name">珍爱团</h5>';a+='<div class="member">成员 <span id="cherish-group-member">0</span></div>';a+="</div></div>";a+="<table><tr>";a+='<td  id="cherish-group-level-a" title="">团等级<br><span id="cherish-group-level">--</span></td>';a+='<td  id="cherish-group-rank-a" title="">排名<br><span id="cherish-group-rank">--</span></td>';a+='<td  id="cherish-group-cup-a" title="珍爱团还没得到过超星奖杯哦！">奖杯<br><span id="cherish-group-cup">--</span></td>';a+="</tr><tr>";a+='<td colspan="3" id="cherish-fans-ranks-td"><div class="open-list"><a  href="javascript:;" title="粉丝排行" id="cherish-fans-ranks-a"><span>粉丝排行</span><span class="text ellipsis" id="cherish-fans-top1-name"></span></a><div class="icon arrow" id="cherish-fans-rank-arrow"><div class="list" id="cherish-fans-rank-list" ><ul id="cherish-fans-ranks"><li class="ellipsis"><span class="icon order order-1">1</span><i class="cherish-icon level-1 icon">珍爱团</i><a href="#">虚位以待</a></li><li class="ellipsis"><span class="icon order order-2">2</span><i class="cherish-icon level-1 icon">珍爱团</i><a href="#">虚位以待</a></li><li class="ellipsis"><span class="icon order order-3">3</span><i class="cherish-icon level-1 icon">珍爱团</i><a href="#">虚位以待</a></li><li class="ellipsis"><span class="icon order">4</span><i class="cherish-icon level-1 icon">珍爱团</i><a href="#">虚位以待</a></li><li class="ellipsis"><span class="icon order">5</span><i class="cherish-icon level-1 icon">珍爱团</i><a href="#">虚位以待</a></li><li class="ellipsis"><span class="icon order">6</span><i class="cherish-icon level-1 icon">珍爱团</i><a href="#">虚位以待</a></li><li class="ellipsis"><span class="icon order">7</span><i class="cherish-icon level-1 icon">珍爱团</i><a href="#">虚位以待</a></li><li class="ellipsis"><span class="icon order">8</span><i class="cherish-icon level-1 icon">珍爱团</i><a href="#">虚位以待</a></li><li class="ellipsis"><span class="icon order">9</span><i class="cherish-icon level-1 icon">珍爱团</i><a href="#">虚位以待</a></li><li class="ellipsis"><span class="icon order">10</span><i class="cherish-icon level-1 icon">珍爱团</i><a href="#">虚位以待</a></li></ul><div class="bg bg-t"></div><div class="bg bg-b"></div></div></div></div></td>';a+="</tr>";a+="</table>";a+='<div class="my" id="cherish-my-title" style="display: none">';a+='<div class="title">我的粉丝头衔<div class="icon" id="title-tips-icon-div"><div class="title-tips"><div class="content"><ul><li>头衔积分将决定粉丝头衔</li><li>头衔积分为最近10天（不含当天）累计积分，每天0点刷新</li></ul><table><tr><td>积分</td><td>粉丝头衔</td><td>勋章</td></tr><tr><td>珍爱粉</td><td class="color-purple">220分</td><td><i class="cherish-icon level-5 icon">珍爱团</i></td></tr><tr><td>死忠粉</td><td class="color-purple">150分</td><td><i class="cherish-icon level-4 icon">珍爱团</i></td></tr><tr><td>铁杆粉</td><td class="color-purple">80分</td><td><i class="cherish-icon level-3 icon">珍爱团</i></td></tr><tr><td>小粉丝</td><td class="color-purple">30分</td><td><i class="cherish-icon level-2 icon">珍爱团</i></td></tr><tr><td>路转粉</td><td class="color-purple">30分以下</td><td><i class="cherish-icon level-1 icon">珍爱团</i></td></tr></table></div><div class="bg-t"></div><div class="bg-b"></div></div></div></div>';a+='<div class="rate-process"><i id="cherish-my-title-level" class="cherish-icon icon">珍爱团</i>';a+='<div class="rate-bar" id="cherish-rate-bar" title="">';a+='<div class="bg"><div class="bg-l"></div><div class="bg-r"></div></div>';a+='<div class="rate-mask right-angle" id="cherish-my-title-process" style="width:0%;"><div class="bg-l"></div><div class="bg-r"></div></div>';a+='<div class="text" id="cherish-my-title-process-text">0/0</div>';a+="</div>";a+='<i id="cherish-my-title-next-level" class="cherish-icon icon">珍爱团</i></div>';a+='<div class="tips" id="cherish-my-score-change"></div>';a+="</div>";a+='<a href="javascript:;" class="link" id="cherish-open-link">加入珍爱团，成为真爱粉&gt;&gt;</a>';a+="</div>";a+="</div>";$("#"+cherish.tabContentDiv).html(a);$("#"+cherish.tabContentDiv).css({height:cherish.tabContentDiv_MinHeight+"px"});cherish.initDiv=true;cherish.bindEvent()},bindEvent:function(){$("#cherish-fans-rank-arrow").unbind("mouseover").mouseover(function(){var a=cherish.tabContentDiv_MaxHeight;if(!cherish.tabContentDiv_myTitle_show){a-=70}$("#"+cherish.tabContentDiv).css({height:a+"px"});if(cherish.tabContentDiv_myTitle_show){$("#cherish-fans-rank-list").css({top:"150px"})}else{$("#cherish-fans-rank-list").css({top:"70px"})}if(EntAppReady.ready){cherish.requestCherishFansRank()}});$("#cherish-fans-rank-arrow").unbind("mouseleave").mouseleave(function(){cherish.setCherishBasicInfoDivHeight()});$("#title-tips-icon-div").unbind("mouseover").mouseover(function(){$("#"+cherish.tabContentDiv).css({height:(cherish.tabContentDiv_MaxHeight-70)+"px"})});$("#title-tips-icon-div").unbind("mouseleave").mouseleave(function(){cherish.setCherishBasicInfoDivHeight()});$("#cherish-group-level-a").unbind("click").click(function(){cherish.openCherishDialog(1)});$("#cherish-group-level-a").unbind("mouseover").mouseover(function(){cherish.requestGroupInfo()});$("#cherish-group-pic").unbind("mouseover").mouseover(function(){cherish.requestGroupInfo()});$("#cherish-fans-ranks-td").unbind("click").click(function(){cherish.openCherishDialog(2)});$("#cherish-open-link").unbind("click").click(function(){cherish.openCherishDialog(3)});$("#cherish-group-rank-a").unbind("click").click(function(){window.open("http://m.yy.com/earn/cherish/v4/pc/cherishTab.html?isClient=0&topage=1","_blank")});$("#cherish-group-cup-a").unbind("click").click(function(){window.open("http://m.yy.com/earn/cherish/v4/pc/cherishTab.html?isClient=0&topage=2","_blank")})},setCherishBasicInfoDivHeight:function(){var a=cherish.tabContentDiv_MinHeight;if(cherish.tabContentDiv_myTitle_show){a+=cherish.tabContentDiv_MyInfoHeight}$("#"+cherish.tabContentDiv).css({height:a+"px"})},isCherishCanShow:function(b){if(!liveplayer.firstMic){cherish.hideCherishDiv();return}var a=false;if(window.PageContext.channelType!=cherish.type_channel_no_wheel){var c=cherish.dataMap[liveplayer.firstMic+"|roomId"];if(c>0){a=true}}else{if(!window.PageContext.owuid){cherish.getRoomInfo()}if(window.PageContext.owuid==liveplayer.firstMic){a=true}}if(a){b();liveplayer.isCherishTabShow(true)}else{liveplayer.isCherishTabShow(false)}},receiveCherishBasicInfo:function(a){console.log("cherish  -- receiveCherishBasicInfo");console.log(a);cherish.dataMap[cherish.key_baseGroupInfo]=a;if(a){window.PageContext.channelType=a.channelType}if(!cherish.initDiv){cherish.initRender(cherish.tabContentDiv)}cherish.isCherishCanShow(cherish.renderCherishBaseGroupData)},renderCherishBaseGroupData:function(){if(cherish.dataMap[cherish.key_baseGroupInfo]){var j=cherish.dataMap[cherish.key_baseGroupInfo];if(j.anchorUid!=liveplayer.firstMic){console.log(j.anchorUid+"!="+liveplayer.firstMic);return}if(!$.isEmptyObject(j.infoGroup)){if(j.infoGroup.cardpic){var f="http://image.yy.com/earn/"+j.infoGroup.cardpic+"?imageview/0/w/116/h/116";$("#cherish-group-pic").attr("src",f)}else{$("#cherish-group-pic").attr("src","http://res1.home.yystatic.com/images/show/room/cherish/snap.jpg")}cherish.cherishGroupName=j.infoGroup.medal;$("#cherish-group-name").text(cherish.cherishGroupName);$("#cherish-group-member").text(j.infoGroup.numb);$("#cherish-list-div").attr("class","cherish-list level-"+cherish.getAnchorRealCherishLevel(j.infoGroup.bglevel));cherish.cherishGroupMaxLevel=j.infoGroup.maxlevel;cherish.cherishGroupLevel=j.infoGroup.level;$("#cherish-group-level").text(j.infoGroup.level);var k=parseInt(j.infoGroup.level)+1;if(k>j.infoGroup.maxlevel){k=j.infoGroup.maxlevel}var a="已达到LV7，增加积分提升赛季排名";if(cherish.cherishGroupLevel!=cherish.cherishGroupMaxLevel){a="还差"+(j.infoGroup.upgrade-j.infoGroup.score)+"积分升到LV"+k+""}a+="，\n每月1号0点重新计算";$("#cherish-group-level-a").attr("title",a);var e="团的当前积分为"+j.infoGroup.score+"";if(k!=j.infoGroup.maxlevel){e+="，距升级至LV"+k+"还差"+(j.infoGroup.upgrade-j.infoGroup.score)+"积分"}$("#cherish-group-pic-div").attr("title",e);if(cherish.cherishGroupLevel>=cherish.cherishGroupMaxLevel){var d=j.infoGroup.rank;if(d>0){if(d>50){d="50+"}cherish.cherishGroupRank=d;$("#cherish-group-rank").text(d)}else{$("#cherish-group-rank").text("--")}}else{$("#cherish-group-rank").text("--");$("#cherish-group-rank-a").attr("title","珍爱团未达到LV7，无法参与本月超星赛季哦！")}cherish.cherishGroupCups=j.infoGroup.cups;if(j.infoGroup.cups>0){$("#cherish-group-cup-a").attr("title","超级巨星的认证奖杯！");$("#cherish-group-cup").text(j.infoGroup.cups)}else{$("#cherish-group-cup").text("--")}}if(!$.isEmptyObject(j.toujieTop1Fans)){var g=j.toujieTop1Fans;if(g){$("#cherish-fans-top1-name").text(decodeURIComponent(g.nick))}}var i="加入珍爱团，成为真爱粉>>";var h=j.infoMine;if(h&&j.myUid==LoginUtil.getLoginUid()){if(h.leftsecs>0){var b=7*24*60*60;if(h.leftsecs>b){i="立即续费>>"}else{var c=Math.ceil(h.leftsecs/b);i=c+"天后过期，立即续费>>"}}}$("#cherish-open-link").text(i);cherish.setCherishAnchorInfo(j.infoGroup)}},setCherishAnchorInfo:function(e){var d="http://res1.home.yystatic.com/images/show/room/cherish/";var f=1;if(e.bglevel){f=e.bglevel}var b=cherish.getAnchorRealCherishLevel(f);if(b>0){cherish.cherishGroupMedalPic=d+b+".png"}else{cherish.cherishGroupMedalPic=""}var c="<p>暂无珍爱团赛季排名</p>";if(cherish.cherishGroupLevel>=cherish.cherishGroupMaxLevel){c="<p>珍爱团赛季中排名 <span>"+cherish.cherishGroupRank+"</span></p>"}var a='<div id="cherishInfo"><div class="img"><i class="icon level-'+b+'"></i></div><div class="text"><p>巨星认证</p>'+c+"</div></div>";if(liveplayer&&liveplayer.onAnchorCherishIcon){liveplayer.onAnchorCherishIcon(cherish.cherishGroupMedalPic,a)}},getAnchorRealCherishLevel:function(b){var a=0;if(b==2||b==3){a=1}else{if(b==4||b==5){a=2}else{if(b==6){a=3}else{if(b==7){a=4}}}}return a},receiveMyFansTitleInfo:function(a){console.log("cherish  --  receiveMyFansTitleInfo");console.log(a);cherish.dataMap[cherish.key_myFansTitleInfo]=a;if(!cherish.initDiv){cherish.initRender(cherish.tabContentDiv)}cherish.isCherishCanShow(cherish.renderMyFansTitleData)},renderMyFansTitleData:function(){var h=true;if(cherish.dataMap[cherish.key_myFansTitleInfo]){var c=cherish.dataMap[cherish.key_myFansTitleInfo];if(c){if(c.result==0&&c.myUid==LoginUtil.getLoginUid()&&c.toujieInfo){if(!cherish.isCherishUser(c.toujieInfo)){cherish.hideMyTitleDiv();return}cherish.tabContentDiv_myTitle_show=true;$("#cherish-my-title").show();$("#"+cherish.tabContentDiv).css({height:(cherish.tabContentDiv_MinHeight+cherish.tabContentDiv_MyInfoHeight)+"px"});h=false;var g=c.toujieInfo.score;var a=c.toujieInfo.nextscore;var f=parseInt(g/a*100)+"%";$("#cherish-my-title-process").css({width:f});$("#cherish-my-title-process-text").text(g+"/"+a);var d="今天积分 <span >+"+c.toujieInfo.today+"</span>， ";if(c.toujieInfo.x>0){d+="头衔积分将增长 <span>"+c.toujieInfo.x+"</span>"}else{if(c.toujieInfo.x<0){d+="头衔积分将下降 <span>"+c.toujieInfo.x+"</span>"}else{d+="头衔积分将保持不变"}}$("#cherish-my-score-change").html(d);$("#cherish-my-title-level").addClass("level-"+c.toujieInfo.level).text(cherish.cherishGroupName);var e=parseInt(c.toujieInfo.level)+1;if(e>c.toujieInfo.maxlevel){e=c.toujieInfo.maxlevel}$("#cherish-my-title-next-level").addClass("level-"+e).text(cherish.cherishGroupName);var b="我的珍爱值为"+g+"";if(e!=c.toujieInfo.maxlevel){b+="，距升级至LV"+e+"还差"+(a-g)+"真爱值"}}}}if(h){cherish.hideMyTitleDiv()}},hideMyTitleDiv:function(){cherish.tabContentDiv_myTitle_show=false;$("#cherish-my-title").hide();$("#"+cherish.tabContentDiv).css({height:cherish.tabContentDiv_MinHeight+"px"})},isCherishUser:function(a){if(a.level==1&&a.score==0&&a.today==0&&a.rank==0){return false}return true},receiveFansRankInfo:function(a){console.log("cherish  --  receiveFansRankInfo");console.log(a);cherish.cherishFansRankResponse=true;cherish.dataMap[cherish.key_fansRankInfo]=a;if(!cherish.initDiv){cherish.initRender(cherish.tabContentDiv)}cherish.isCherishCanShow(cherish.renderFansRankInfo)},renderFansRankInfo:function(){var g=cherish.dataMap[cherish.key_fansRankInfo];if(g&&g.result==0){var h=g.toujieRank;var d=10-h.length;for(var f=0;f<d;f++){var a={nick:"虚位以待",level:1};h.push(a)}var e="";var c="";for(var b=0;b<h.length;b++){c='<i class="cherish-icon level-'+h[b].level+' icon">'+cherish.cherishGroupName+"</i>";if(b<3){e+='<li class="ellipsis"><span class="icon order order-'+(b+1)+'">'+(b+1)+"</span>"+c+'<a href="#">'+decodeURIComponent(h[b].nick)+"</a></li>"}else{e+='<li class="ellipsis"><span class="icon order">'+(b+1)+"</span>"+c+'<a href="#">'+decodeURIComponent(h[b].nick)+"</a></li>"}}$("#cherish-fans-ranks").html(e)}},requestCherishFansRank:function(){if(cherish.cherishFansRankResponse){cherish.cherishFansRankResponse=false;EntAppHandler.call("truelove_toujie_v4_rank_req",{offset:0,limit:10});setTimeout(function(){cherish.cherishFansRankResponse=true},10*1000)}else{console.log("requestCherishFansRank 上次请求还没有响应，这次不发起请求！")}},requestGroupInfo:function(){EntAppHandler.call("truelove_get_current_group_score_req")},receiveGroupInfo:function(a){console.log("cherish  --  receiveGroupInfo");console.log(a);if(cherish.dataMap[cherish.key_baseGroupInfo]){a.cups=cherish.dataMap[cherish.key_baseGroupInfo].infoGroup.cups;a.numb=cherish.dataMap[cherish.key_baseGroupInfo].infoGroup.numb;a.medal=cherish.dataMap[cherish.key_baseGroupInfo].infoGroup.medal;a.cardpic=cherish.dataMap[cherish.key_baseGroupInfo].infoGroup.cardpic;a.bglevel=cherish.dataMap[cherish.key_baseGroupInfo].infoGroup.bglevel;if(a.level>a.bglevel){a.bglevel=a.level}cherish.dataMap[cherish.key_baseGroupInfo].infoGroup=a;cherish.isCherishCanShow(cherish.renderCherishBaseGroupData)}},getRoomInfo:function(){if(!liveplayer.pageInfo||!liveplayer.pageInfo.ssid){return}if(!liveplayer.firstMic){return}$.ajax({url:domain+"/ent/room/getRoomInfo.action",type:"get",dataType:"json",data:{ssid:liveplayer.pageInfo.ssid,anchorId:liveplayer.firstMic},excetpion:function(a){},success:function(a){if(!a){return}if(!PageContext){window.PageContext={}}window.PageContext.owuid=a.owuid;cherish.dataMap[liveplayer.firstMic+"|roomId"]=a.roomId;cherish.resetRenderCherishDiv();cherish.isCherishCanShow(cherish.renderCherishBaseGroupData);cherish.isCherishCanShow(cherish.renderMyFansTitleData);EntAppHandler.call("getTopMicRoomid",{uid:liveplayer.firstMic,roomId:a.roomId})}})},getRoomId:function(){if(!liveplayer.pageInfo||!liveplayer.pageInfo.ssid){return}if(!liveplayer.firstMic){return}$.ajax({url:domain+"/ent/room/getRoomId.action",type:"get",dataType:"json",data:{anchorId:liveplayer.firstMic},excetpion:function(a){},success:function(a){if(a){cherish.dataMap[liveplayer.firstMic+"|roomId"]=a.roomId;if(a.roomId<=0){cherish.hideCherishDiv()}else{cherish.resetRenderCherishDiv();cherish.isCherishCanShow(cherish.renderCherishBaseGroupData);cherish.isCherishCanShow(cherish.renderMyFansTitleData);liveplayer.isCherishTabShow(true)}EntAppHandler.call("getTopMicRoomid",{uid:liveplayer.firstMic,roomId:a.roomId})}}})},includeCherishResource:function(){include("http://earn.yystatic.com/earn/js/cherish/v4/pc/proxy.js")},openCherishDialog:function(a){if(!LoginUtil.isLogin()){LoginUtil.showLoginOrRegister();return}if(!liveplayer.pageInfo){new ShowDialog.POPUP({width:200,content:"获取主播信息失败！",timeout:true});return}if(liveplayer.firstMic){if(!a){a=3}showChershDialog(liveplayer.firstMic,a,300)}else{new ShowDialog.POPUP({width:200,content:"首麦无人",timeout:true})}}};function showChershDialog(b,a,d){var c="http://m.yy.com/earn/cherish/v4/pc/cherish.html?agentId="+b+"&toPage="+a+"&fromPage=1&source=1&joint=2&partner=0&webYY=1";window.cherishPopup=new ShowDialog.POPUP({width:800,height:650,content:'<div id="cherishDiv" class="open-cherish-div"><iframe id="cherishIframe" src="'+c+'" width="800px" height="590px" style="border:none"></iframe></div>',yourClass:"popup-noble"});$(".popup-noble .popup-box").css({width:"0px",height:"0px","margin-left":"-500px","margin-top":"-320px"})}function closeCherishPOPUP(){$("#cherishIframe").attr("src","");$.uiwidget.popupHide({id:"cherishDiv"})}function closeCherishDialog(){window.cherishPopup.removePop()}$(document).ready(function(){EntAppReady.addFlashEntReadyCallback(function(){cherish.onFlashReady()})});var TR_TEMPLATE='<tr item-type="@giftType"><td class="col-1"><img src="@giftImg"></td><td class="col-2">@numb</td><td class="col-3">@rank</td><td class="col-4">@rnumb</td></tr>';var weekStar={isWeekShow:false,timer:null,weekStarmod:null,weekStarmain:null,weekStarUid:null,firstMicTimer:null,weekGiftRankList:[],weekGiftList:[],scrollObj:null,onReady:function(){weekStar.weekStarmod=$("#room-week-star");weekStar.weekStarmain=$("#week-star-id");weekStar.bindEvent();weekStar.initClientReceiver();weekStar.initData();weekStar.resizeToolbarButtons()},bindEvent:function(){weekStar.weekStarmod.on("click",function(a){weekStar.noBubble(a)});weekStar.weekStarmain.on("click",function(a){weekStar.pageIndex=0;if(weekStar.weekStarmod.hasClass("current")){weekStar.hideWeekstar()}else{liveplayer.showMask();weekStar.weekStarmod.toggleClass("current");if(!weekStar.isWeekShow){weekStar.isWeekShow=true;weekStar.getWeekStarData();weekStar.resizeScroll()}else{weekStar.isWeekShow=false}}weekStar.noBubble(a);weekStar.hideToolbarBottuns()});$("body").on("click",function(){if(weekStar.isWeekShow){weekStar.isWeekShow=false;weekStar.weekStarmod.toggleClass("current")}liveplayer.hideMask()});$("#refresh-weekstar").click(function(){weekStar.getWeekStarData()});$("#room-week-star .head .close").click(function(){weekStar.weekStarmod.toggleClass("current");weekStar.isWeekShow=false;liveplayer.hideMask()});weekStar.scrollObj=analogscroll("#week-star-rank-table",{scrollbar:"#weekstar-scrollarea"});weekStar.initToolbarBottuns()},resizeToolbarButtons:function(){var b=$(".ent-content>.toolbar .buttons");var a=b.children(".wrap");var c=b.find(".item");var d=c.outerWidth(true)*c.length;if(d>=b.width()){b.addClass("expand");a.hide();b.children(".expand-btn").text("点击展开")}else{a.show();b.removeClass("expand")}},initToolbarBottuns:function(){var b=$(".ent-content>.toolbar .buttons");var a=b.children(".wrap");var c=b.find(".item");var d=c.outerWidth(true)*c.length;b.children(".expand-btn").on("click",function(){if(a.css("display")=="none"){$(this).text("点击关闭");liveplayer.showMask()}else{$(this).text("点击展开");liveplayer.hideMask()}a.toggle();return false});header.onresize(function(){if(d>=b.width()){b.addClass("expand");a.hide();b.children(".expand-btn").text("点击展开")}else{a.show();b.removeClass("expand")}});$("body").on("click",function(){weekStar.hideToolbarBottuns()})},hideToolbarBottuns:function(){var b=$(".ent-content>.toolbar .buttons");var a=b.children(".wrap");var c=b.children(".expand-btn").text();if(c=="点击关闭"){b.children(".expand-btn").text("点击展开");a.toggle()}},hideWeekstar:function(){liveplayer.hideMask();weekStar.weekStarmod.removeClass("current");weekStar.isWeekShow=false},resizeScroll:function(){weekStar.scrollObj.resize();if(weekStar.weekGiftList.length>5){$(".list .w-contribution-scrollarea").show()}else{$(".list .w-contribution-scrollarea").hide()}},noBubble:function(a){var a=a||window.event;if(a.stopPropagation){a.stopPropagation()}else{a.cancelBubble=true}},initClientReceiver:function(){window.recevive_client_consume_rank_cb=function(a){try{weekStar.onReceiveData(a)}catch(b){console.log(b)}weekStar.timeOutResetWeekStatBtn();weekStar.disableWeekStatBtn()}},getCurrentData:function(){var b=liveplayer.pageInfo.ssid;var a=liveplayer.pageInfo.anchorInfo.id;if(EntAppReady.isReady()){EntAppHandler.call("call_client_consume_rank",{subCid:b,uAnchorId:a,expandInfo:{from:sourceAdmin.getSource(),cpuid:sourceAdmin.getCpuid()}})}},onReceiveData:function(e){var a=e.mlist;weekStar.weekGiftRankList=[];for(var b=0;b<a.length;b++){var d=a[b];if(d){var c=d.type;if(Gift.weekStarGiftMap[c]){if(d.rank>=100){d.rank="99+"}d.smallUrl=Gift.weekStarGiftMap[c].smallUrl;weekStar.weekGiftRankList.push(d)}}}weekStar.weekGiftRankList.sort(function(g,f){if(g.rank=="99+"){return 1}return g.rank*1-f.rank*1});weekStar.replaceGiftRankData()},initData:function(){weekStar.weekStarUid=liveplayer.pageInfo.anchorInfo.id;weekStar.setWeekStarAnchorPhoto();liveplayer.addMicListChangeCallback(weekStar.getAnchorMICPhoto);weekStar.weekGiftList=[];var b="";$.each(Gift.weekStarGiftMap,function(c,f){var d={};d.type=c;d.numb="0";d.rank="99+";d.rnumb="0";if(f&&f.smallUrl){d.smallUrl=f.smallUrl;weekStar.weekGiftList.push(d);var e=TR_TEMPLATE;e=e.replace("@giftType",d.type);e=e.replace("@giftImg",d.smallUrl);e=e.replace("@rank",d.rank);e=e.replace("@numb",d.numb);e=e.replace("@rnumb",d.rnumb);b+=e}});$("#room-week-star .list table").html(b);weekStar.resizeScroll();var a=web2flash.getMicListSync();if(a&&a.length>0){weekStar.weekStarmain.show()}},getAnchorMICPhoto:function(a){if(a.length>0){weekStar.weekStarmain.show();if(weekStar.weekStarUid!=liveplayer.firstMic){if(weekStar.firstMicTimer){window.clearInterval(weekStar.firstMicTimer)}weekStar.firstMicTimer=window.setInterval(function(){weekStar.setWeekStarAnchorPhoto();if(weekStar.weekStarUid==liveplayer.firstMic){weekStar.getCurrentData();window.clearInterval(weekStar.firstMicTimer)}},1000)}}else{weekStar.hideWeekstar();weekStar.weekStarmain.hide()}},setWeekStarAnchorPhoto:function(){weekStar.weekStarUid=liveplayer.pageInfo.anchorInfo.id;var a=liveplayer.pageInfo.anchorInfo.logo;if(!a||a.trim().len()<=0){a="http://yyweb.yystatic.com/pc/images/default_portrait.jpg"}$(".head .inline-block img").attr("src",a)},replaceGiftRankData:function(){var a="";$.each(weekStar.weekGiftRankList,function(b,d){var c=d.type;var f=$('#week-star-rank tr[item-type="'+c+'"]');if(f&&f.length>0){f.remove()}var e=TR_TEMPLATE;e=e.replace("@giftType",d.type);e=e.replace("@giftImg",d.smallUrl);e=e.replace("@rank",d.rank);e=e.replace("@numb",d.numb);e=e.replace("@rnumb",d.rnumb);a+=e});$("#room-week-star table").prepend(a)},resetWeekStatBtn:function(){weekStar.weekStarmain.removeClass("dis-btn")},disableWeekStatBtn:function(){weekStar.weekStarmain.addClass("dis-btn")},getWeekStarData:function(){if(!weekStar.weekStarmain.hasClass("dis-btn")){weekStar.getCurrentData()}},timeOutResetWeekStatBtn:function(){if(weekStar.timer){window.clearTimeout(weekStar.timer)}weekStar.timer=window.setTimeout(function(){weekStar.resetWeekStatBtn()},60000)}};$(document).ready(function(){EntAppReady.addFlashEntReadyCallback(function(){weekStar.onReady()})});var giftHistory={offset:0,pageSize:200,renderOffset:0,renderPageSize:20,giftHistoryList:[],trTemplate:'<li m="%`orderId`%" class="%`liClass`%"><div class="col-1">%`time`%</div><div class="col-2 ellipsis">%`userName`%</div><div class="col-3"><img src="%`giftUrl`%"> %`giftNum`%</div></li>',init:function(){giftHistory.btn=$(".ent-content .buttons .gift-record-btn");giftHistory.box=$(".ent-content .gift-record");giftHistory.table=$(".ent-content .gift-record #gift-record-table");giftHistory.container=giftHistory.table.find("ul");giftHistory.scrollarea=$(".ent-content .gift-record .w-liveplayer-scrollarea");giftHistory.closeBtn=giftHistory.box.find(".head .close");giftHistory.scrollObj=analogscroll(giftHistory.table,{scrollbar:giftHistory.scrollarea,onend:giftHistory.scrollEnd,distance:5,endDistance:10});giftHistory.scrollObj.resize();this.bindEvent()},scrollEnd:function(){if(giftHistory.renderOffset<giftHistory.giftHistoryList.length-1){giftHistory.renderNextPage()}else{giftHistory.getGiftHistory(giftHistory.offset,giftHistory.pageSize)}},bindEvent:function(){giftHistory.box.click(function(a){giftHistory.stopEventBubble(a)});giftHistory.btn.click(function(a){giftHistory.cleanData();if(0>=giftHistory.container.find("tr").length){giftHistory.getGiftHistory(giftHistory.offset,giftHistory.pageSize)}if(giftHistory.box.hasClass("current")){liveplayer.hideMask()}else{liveplayer.showMask()}giftHistory.box.toggleClass("current");giftHistory.scrollObj.resize();giftHistory.stopEventBubble(a)});giftHistory.closeBtn.click(function(){giftHistory.box.removeClass("current");liveplayer.hideMask()});$("body").on("click",function(){if(giftHistory.box.hasClass("current")){giftHistory.box.removeClass("current");liveplayer.hideMask()}})},cleanData:function(){giftHistory.offset=0;giftHistory.renderOffset=0;giftHistory.giftHistoryList=[];giftHistory.container.empty()},getGiftHistory:function(b,a){EntAppHandler.call("call_gift_history",{offset:b,size:a,expandInfo:null})},receiveGiftHistory:function(a){if(!a){return}var b=a.mlist||[];if(0>=b.length){return}giftHistory.offset+=b.length;b=giftHistory.filter(b);giftHistory.giftHistoryList=giftHistory.giftHistoryList.concat(giftHistory.giftHistoryList,b);giftHistory.renderNextPage()},renderNextPage:function(){var a=giftHistory.giftHistoryList.slice(giftHistory.renderOffset,giftHistory.renderOffset+giftHistory.renderPageSize);giftHistory.renderOffset+=a.length;giftHistory.render(a)},render:function(c){if(!c||0>=c.length){return}var b="";var a=LoginUtil.getLoginUid()||"";$.each(c,function(s,m){var q=m.UID||"999";var p=m.NICK||"";var d=m.NOBLE||0;var k=m.PROPTYPE||"";var n=m.PROPNUM||"";var l=m.TIMESTAMP||0;var g=m.ORDERID||(new Date().getTime()+parseInt(100000*Math.random()));var i=new Date();i.setTime(l*1000);var o=i.getHours();var j=i.getMinutes();var r=i.getSeconds();var h=(10>o?"0"+o:o)+":"+(10>j?"0"+j:j)+":"+(10>r?"0"+r:r);var f=Gift.giftMap[k]?(Gift.giftMap[k].iconUrl||""):"";var u="";if(a===q){u="active"}var t=giftHistory.trTemplate.replace(/%`liClass`%/ig,u).replace(/%`giftId`%/ig,k).replace(/%`orderId`%/ig,g).replace(/%`time`%/ig,h).replace(/%`userName`%/ig,p).replace(/%`giftUrl`%/ig,f).replace(/%`giftNum`%/ig,n);b+=t});giftHistory.container.append(b);giftHistory.scrollObj.resize()},filter:function(d){if(0>=giftHistory.giftHistoryList.length){return d}var a=[];if(5>=giftHistory.giftHistoryList.length){a=giftHistory.giftHistoryList}else{a=giftHistory.giftHistoryList.slice(giftHistory.giftHistoryList.length-5)}var c={};$.each(a,function(e,f){c[$(f).attr("m")]=true});var b=a[a.length-1].TIMESTAMP||0;d=d.filter(function(g,f,i){var e=g.ORDERID||(new Date().getTime()+parseInt(100000*Math.random()));if(c[e]){return false}var h=g.TIMESTAMP||999;if(h>b){return false}return true});return d},stopEventBubble:function(a){var a=a||window.event;if(a.stopPropagation){a.stopPropagation()}else{a.cancelBubble=true}}};giftHistory.init();